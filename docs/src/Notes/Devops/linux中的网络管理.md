---
title: "linuxä¸­çš„ç½‘ç»œç®¡ç†"
outline: deep
desc: "linuxä¸­çš„ç½‘ç»œç®¡ç†"
tags: "Devops"
updateTime: "2025-04-23 16:33"
---

# Linuxç½‘ç»œè¯Šæ–­å·¥å…·å…¨æ™¯å›¾

## ğŸŒ ç½‘ç»œå·¥å…·åˆ†ç±»æ¶æ„

```mermaid
mindmap
    root((ç½‘ç»œå·¥å…·))
        è¿æ¥æµ‹è¯•
            ping
            traceroute
            tracepath
        DNSè§£æ
            dig
            host
            nslookup
        çŠ¶æ€ç›‘æ§
            netstat
            ss
            iftop
        é…ç½®ç®¡ç†
            hostname
            route
            ip
        ç”¨æˆ·ä¿¡æ¯
            finger
            who
```

## ä¸€ã€è¿æ¥è¯Šæ–­å·¥å…·

### 1. è¿é€šæ€§æµ‹è¯• (ping)

```mermaid
sequenceDiagram
    æœ¬åœ°ä¸»æœº->>è¿œç¨‹ä¸»æœº: ICMPè¯·æ±‚åŒ…
    è¿œç¨‹ä¸»æœº-->>æœ¬åœ°ä¸»æœº: ICMPå“åº”åŒ…
    loop æŒç»­æ£€æµ‹
        æœ¬åœ°ä¸»æœº->>è¿œç¨‹ä¸»æœº: å‘é€æ¢æµ‹
        è¿œç¨‹ä¸»æœº-->>æœ¬åœ°ä¸»æœº: è¿”å›æ—¶å»¶
    end
```

**å®ç”¨å‚æ•°ï¼š**

```bash
$ ping -c 4 www.google.com  # å‘é€4æ¬¡æ¢æµ‹åŒ…
$ ping -i 0.5 example.com  # 0.5ç§’é—´éš”
```

### 2. è·¯å¾„è¿½è¸ª (traceroute)

```mermaid
flowchart TD
    A[æœ¬åœ°] --> B[ç½‘å…³]
    B --> C{è·ƒç‚¹1}
    C --> D{è·ƒç‚¹2}
    D --> E[...]
    E --> F[ç›®æ ‡ä¸»æœº]
```

**å¯¹æ¯”å·¥å…·ï¼š**

| å·¥å…·       | éœ€è¦root | åè®®     | ç‰¹ç‚¹         |
| ---------- | -------- | -------- | ------------ |
| traceroute | æ˜¯       | UDP/ICMP | ä¼ ç»Ÿæ ‡å‡†     |
| tracepath  | å¦       | ICMP     | ç®€å•æ˜“ç”¨     |
| mtr        | æ˜¯       | æ··åˆ     | å®æ—¶åŠ¨æ€ç›‘æ§ |



**å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹ï¼š**

```bash
# æŸ¥è¯¢è¯¦ç»†DNSè®°å½•
$ dig +trace example.com

# æ£€æŸ¥é‚®ä»¶æœåŠ¡å™¨é…ç½®
$ dig MX example.com

# å¿«é€Ÿè§£æç»“æœ
$ host -t A example.com
```

## ä¸‰ã€ç½‘ç»œçŠ¶æ€ç›‘æ§

### netstatæ ¸å¿ƒåŠŸèƒ½å›¾è§£

```mermaid
classDiagram
    class netstat{
        +æ˜¾ç¤ºæ‰€æœ‰è¿æ¥ -a
        +æ˜¾ç¤ºTCPè¿æ¥ -t
        +æ˜¾ç¤ºUDPè¿æ¥ -u
        +æ˜¾ç¤ºç›‘å¬ç«¯å£ -l
        +æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ -p
        +è·¯ç”±è¡¨æŸ¥çœ‹ -r
    }
```

**ç°ä»£æ›¿ä»£æ–¹æ¡ˆï¼š**

```bash
$ ss -tulpn  # æ›´å¿«é€Ÿçš„socketç»Ÿè®¡
$ iftop -i eth0  # å®æ—¶æµé‡ç›‘æ§
$ nethogs  # è¿›ç¨‹çº§å¸¦å®½ç›‘æ§
```

## å››ã€ç½‘ç»œé…ç½®ç®¡ç†

### IPå‘½ä»¤å¥—ä»¶åŠŸèƒ½æ ‘

```mermaid
graph TD
    ip-->ip_addr[åœ°å€ç®¡ç†]
    ip-->ip_route[è·¯ç”±ç®¡ç†]
    ip-->ip_link[é“¾è·¯ç®¡ç†]
    ip_addr-->add[æ·»åŠ IP]
    ip_addr-->del[åˆ é™¤IP]
    ip_route-->show[æ˜¾ç¤ºè·¯ç”±]
    ip_route-->change[ä¿®æ”¹è·¯ç”±]
    ip_link-->up[å¯ç”¨æ¥å£]
    ip_link-->down[ç¦ç”¨æ¥å£]
```

**è·¯ç”±ç®¡ç†ç¤ºä¾‹ï¼š**

```bash
# æ˜¾ç¤ºè·¯ç”±è¡¨ï¼ˆç­‰æ•ˆroute -nï¼‰
$ ip route show

# æ·»åŠ é»˜è®¤ç½‘å…³
$ sudo ip route add default via 192.168.1.1

# ä¸´æ—¶ç¦ç”¨ç½‘å¡
$ sudo ip link set eth0 down
```

## äº”ã€ç»¼åˆè¯Šæ–­æ¡ˆä¾‹

### ç½‘ç«™æ— æ³•è®¿é—®æ’æŸ¥æµç¨‹

```mermaid
flowchart TB
    Start[ç½‘ç«™æ— æ³•è®¿é—®] --> A{æœ¬åœ°è§£æ}
    A -- å¤±è´¥ --> B[æ£€æŸ¥/etc/resolv.conf]
    A -- æˆåŠŸ --> C{Pingæµ‹è¯•}
    C -- è¶…æ—¶ --> D[tracerouteè¿½è¸ª]
    C -- æ­£å¸¸ --> E[æ£€æŸ¥ç«¯å£è¿é€šæ€§]
    D --> F[å®šä½ç½‘ç»œé˜»æ–­ç‚¹]
    E --> G[telnet/ncæµ‹è¯•ç«¯å£]
    G -- å¤±è´¥ --> H[æ£€æŸ¥é˜²ç«å¢™è®¾ç½®]
```

**ç»„åˆå·¥å…·ä½¿ç”¨ï¼š**

```bash
# 1. æ£€æŸ¥DNSè§£æ
$ dig +short example.com

# 2. æµ‹è¯•TCPç«¯å£è¿é€šæ€§
$ nc -zv example.com 443

# 3. æŸ¥çœ‹æœ¬åœ°é˜²ç«å¢™è§„åˆ™
$ sudo iptables -L -n -v

# 4. ç›‘æ§å®æ—¶æµé‡
$ sudo tcpdump -i eth0 host example.com
```

---

# Linux `ping` å‘½ä»¤å®Œå…¨æŒ‡å—

## ğŸ“– æ ¸å¿ƒåŠŸèƒ½

- **ç½‘ç»œè¯Šæ–­**ï¼šæ£€æµ‹ä¸»æœºå¯è¾¾æ€§ä¸ç½‘ç»œå»¶è¿Ÿ
- **åè®®åŸºç¡€**ï¼šä½¿ç”¨ICMPåè®®è¿›è¡Œé€šä¿¡
- **å…³é”®æŒ‡æ ‡**ï¼š
  - å¾€è¿”æ—¶é—´ï¼ˆRTTï¼‰
  - æ•°æ®åŒ…ä¸¢å¤±ç‡
  - ç½‘ç»œè·¯å¾„ç¨³å®šæ€§

## ğŸ”§ å‘½ä»¤å‚æ•°é€ŸæŸ¥è¡¨

| å‚æ•° | åŠŸèƒ½æè¿°                   | ç¤ºä¾‹                         |
| ---- | -------------------------- | ---------------------------- |
| `-c` | æŒ‡å®šå‘é€æ¬¡æ•°               | `ping -c 5 google.com`       |
| `-i` | è®¾ç½®å‘é€é—´éš”ï¼ˆç§’ï¼‰         | `ping -i 0.5 example.com`    |
| `-s` | å®šä¹‰æ•°æ®åŒ…å¤§å°ï¼ˆå­—èŠ‚ï¼‰     | `ping -s 1024 localhost`     |
| `-w` | è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰         | `ping -w 3 8.8.8.8`          |
| `-q` | åªæ˜¾ç¤ºç»Ÿè®¡æ‘˜è¦             | `ping -q -c 10 github.com`   |
| `-f` | æ´ªæ°´æ”»å‡»ï¼ˆéœ€rootæƒé™ï¼‰     | `sudo ping -f target.com`    |
| `-T` | æ·»åŠ æ—¶é—´æˆ³                 | `ping -T tsonly 192.168.1.1` |
| `-M` | è·¯å¾„MTUå‘ç°æ¨¡å¼            | `ping -M do example.org`     |
| `-t` | è®¾ç½®TTLå€¼                  | `ping -t 64 cloudflare.com`  |
| `-W` | ç­‰å¾…å“åº”æ—¶é—´ï¼ˆç§’ï¼‰         | `ping -W 2 api.server.com`   |
| `-p` | å¡«å……æ•°æ®åŒ…å†…å®¹ï¼ˆåå…­è¿›åˆ¶ï¼‰ | `ping -p ff device.local`    |

## ğŸ¯ å®ç”¨åœºæ™¯ç¤ºä¾‹

### åŸºç¡€è¿é€šæ€§æµ‹è¯•

```bash
$ ping -c 4 google.com
PING google.com (142.250.66.238) 56(84) bytes of data.
64 bytes from fra24s01-in-f14.1e100.net (142.250.66.238): icmp_seq=1 ttl=117 time=12.3 ms
...
--- google.com ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3005ms
rtt min/avg/max/mdev = 12.273/13.421/14.893/1.052 ms
```

### ç½‘ç»œæ€§èƒ½å‹åŠ›æµ‹è¯•

```bash
# å¿«é€Ÿè¿ç»­å‘é€å¤§åŒ…ï¼ˆéœ€rootæƒé™ï¼‰
$ sudo ping -f -s 1024 192.168.1.1
PING 192.168.1.1 (192.168.1.1) 1024(1052) bytes of data.
................................................................................................................................................................................................................................................................................................................................................................................................................................................................
--- 192.168.1.1 ping statistics ---
689 packets transmitted, 689 received, 0% packet loss, time 2299ms
rtt min/avg/max/mdev = 0.598/1.084/2.347/0.217 ms
```

### è·¯å¾„MTUå‘ç°

```bash
$ ping -M do -s 1500 example.com
PING example.com (93.184.216.34) 1500(1528) bytes of data.
ping: local error: Message too long, mtu=1500
```

## ğŸ› ï¸ é«˜çº§è¯Šæ–­æŠ€å·§

### ç½‘ç»œå»¶è¿Ÿåˆ†æ

```bash
# æŒç»­ç›‘æ§å»¶è¿Ÿï¼ˆæ¯2ç§’ä¸€æ¬¡ï¼‰
$ while true; do ping -c 1 -W 1 8.8.8.8 | grep 'time='; sleep 2; done
64 bytes from 8.8.8.8: icmp_seq=1 ttl=117 time=15.3 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=117 time=18.2 ms
```

### å¸¦æ—¶é—´æˆ³è®°å½•

```bash
# ç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„pingæ—¥å¿—
$ ping -T tsonly -c 60 example.com | ts '[%Y-%m-%d %H:%M:%S]' > ping.log
```

### ç½‘ç»œæ‹“æ‰‘æ¢æµ‹

```bash
# TTLé€’å¢æ¢æµ‹ï¼ˆå®ç°tracerouteæ•ˆæœï¼‰
$ for ttl in {1..30}; do ping -t $ttl -c 1 -W 1 example.com | grep "Time to live"; done
```

## ğŸš¨ å¸¸è§é—®é¢˜å¤„ç†

### ç›®æ ‡ä¸å¯è¾¾

```bash
$ ping unknown.host
ping: unknown.host: Name or service not known

â” æ£€æŸ¥DNSé…ç½®ï¼š`nslookup unknown.host`
```

### 100%ä¸¢åŒ…

```bash
$ ping -c 4 192.168.99.99
PING 192.168.99.99 (192.168.99.99) 56(84) bytes of data.
--- 192.168.99.99 ping statistics ---
4 packets transmitted, 0 received, 100% packet loss, time 3060ms

â” æ£€æŸ¥ï¼š1. ç›®æ ‡ä¸»æœºçŠ¶æ€ 2. é˜²ç«å¢™è®¾ç½® 3. è·¯ç”±é…ç½®
```

### é«˜å»¶è¿ŸæŠ–åŠ¨

```bash
rtt min/avg/max/mdev = 12.273/153.421/1204.893/285.052 ms

â” å¯èƒ½åŸå› ï¼š
1. ç½‘ç»œæ‹¥å¡
2. ç¡¬ä»¶æ•…éšœ
3. ISPçº¿è·¯é—®é¢˜
```

## âš™ï¸ ç”Ÿäº§ç¯å¢ƒå»ºè®®

### è‡ªåŠ¨åŒ–ç›‘æ§è„šæœ¬

```bash
#!/bin/bash
TARGET="db-server.local"
LOG_FILE="/var/log/ping_monitor.log"

while :; do
    TIMESTAMP=$(date +%s)
    STATS=$(ping -c 10 -i 0.2 -q $TARGET | awk '/packet loss/{pl=$6} /rtt/{print pl,$8}')
    echo "$TIMESTAMP $STATS" >> $LOG_FILE
    sleep 300
done
```

### å®‰å…¨æ³¨æ„äº‹é¡¹

```bash
# ç¦æ­¢PINGçš„é˜²å¾¡æªæ–½ï¼ˆä½¿ç”¨iptablesï¼‰ï¼š
$ sudo iptables -A INPUT -p icmp --icmp-type echo-request -j DROP

# ä¸´æ—¶å¯ç”¨PINGæ£€æµ‹ï¼š
$ sudo iptables -I INPUT -p icmp --icmp-type echo-request -j ACCEPT
```

## ğŸ“Š ç»“æœè§£è¯»æŒ‡å—

| æŒ‡æ ‡           | æ­£å¸¸èŒƒå›´   | å¼‚å¸¸è¡¨ç°    | å¯èƒ½åŸå›           |
| -------------- | ---------- | ----------- | ----------------- |
| å»¶è¿Ÿï¼ˆRTTï¼‰    | <100ms     | >500ms      | ç½‘ç»œæ‹¥å¡/ç‰©ç†è·ç¦» |
| æŠ–åŠ¨ï¼ˆjitterï¼‰ | <50ms      | >100ms      | çº¿è·¯ä¸ç¨³å®š        |
| ä¸¢åŒ…ç‡         | 0%-1%      | >5%         | ç¡¬ä»¶æ•…éšœ/ç½‘ç»œä¸­æ–­ |
| TTLå€¼          | é€šå¸¸54-128 | æŒç»­é€’å‡è‡³0 | è·¯ç”±ç¯è·¯          |



# Linux `nslookup` å‘½ä»¤å®Œå…¨æŒ‡å—ï¼šDNS æŸ¥è¯¢ä¸æ•…éšœæ’æŸ¥  

## ä¸€ã€æ ¸å¿ƒåŠŸèƒ½è§£æ  
`nslookup` æ˜¯ Linux ç³»ç»Ÿä¸­ç”¨äº **DNS æŸ¥è¯¢** çš„äº¤äº’å¼å·¥å…·ï¼Œå¯å¿«é€Ÿè·å–åŸŸåè§£æä¿¡æ¯ï¼Œæ˜¯æ’æŸ¥ DNS é…ç½®ã€éªŒè¯åŸŸåè§£æç»“æœçš„æ ¸å¿ƒå·¥å…·ã€‚æ”¯æŒæ­£å‘è§£æï¼ˆåŸŸåâ†’IPï¼‰å’Œåå‘è§£æï¼ˆIPâ†’åŸŸåï¼‰ï¼Œå¹¶èƒ½æŸ¥è¯¢å¤šç§ DNS è®°å½•ç±»å‹ã€‚

---

## äºŒã€å‘½ä»¤è¯­æ³•ä¸æ¨¡å¼  
```bash  
nslookup [é€‰é¡¹] [åŸŸå/IP] [DNSæœåŠ¡å™¨]  
```  
**ä¸¤ç§è¿è¡Œæ¨¡å¼**ï¼š  
1. **äº¤äº’æ¨¡å¼**ï¼šç›´æ¥è¾“å…¥ `nslookup` è¿›å…¥ï¼Œæ”¯æŒè¿ç»­æŸ¥è¯¢  
2. **éäº¤äº’æ¨¡å¼**ï¼šä¸€æ¬¡æ€§æ‰§è¡ŒæŸ¥è¯¢å‘½ä»¤  

---

## ä¸‰ã€å…³é”®é€‰é¡¹é€ŸæŸ¥è¡¨  

| é€‰é¡¹             | åŠŸèƒ½æè¿°                          |  
|------------------|-----------------------------------|  
| `-type=A`        | æŸ¥è¯¢ A è®°å½•ï¼ˆIPv4 åœ°å€ï¼‰          |  
| `-type=AAAA`     | æŸ¥è¯¢ AAAA è®°å½•ï¼ˆIPv6 åœ°å€ï¼‰        |  
| `-type=MX`       | æŸ¥è¯¢é‚®ä»¶äº¤æ¢è®°å½•                   |  
| `-type=NS`       | æŸ¥è¯¢åŸŸåæœåŠ¡å™¨è®°å½•                 |  
| `-type=SOA`      | æŸ¥è¯¢åŸŸæƒå¨èµ·å§‹è®°å½•                 |  
| `-type=TXT`      | æŸ¥è¯¢æ–‡æœ¬è®°å½•ï¼ˆå¦‚ SPF/DKIMï¼‰        |  
| `-type=PTR`      | åå‘è§£æï¼ˆIPâ†’åŸŸåï¼‰                |  
| `-debug`         | æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯                      |  
| `-port=53`       | æŒ‡å®š DNS æœåŠ¡å™¨ç«¯å£               |  

---

## å››ã€å®æˆ˜æ¡ˆä¾‹æ¼”ç¤º  

### 1. åŸºç¡€åŸŸåè§£æ  
```bash  
nslookup google.com  
```  
**è¾“å‡ºç¤ºä¾‹**ï¼š  
```  
Server:		8.8.8.8  
Address:	8.8.8.8#53  

Non-authoritative answer:  
Name:	google.com  
Address: 142.250.194.142  
```  

### 2. æŸ¥è¯¢ MX è®°å½•ï¼ˆé‚®ä»¶æœåŠ¡å™¨ï¼‰  
```bash  
nslookup -type=MX gmail.com  
```  
**è¾“å‡ºç‰‡æ®µ**ï¼š  
```  
gmail.com	mail exchanger = 5 gmail-smtp-in.l.google.com.  
```  

### 3. åå‘è§£æ IP åœ°å€  
```bash  
nslookup 142.250.194.142  
```  
**è¾“å‡ºç»“æœ**ï¼š  
```  
142.194.250.142.in-addr.arpa	name = fra24s01-in-f14.1e100.net.  
```  

### 4. æŸ¥è¯¢åŸŸåæœåŠ¡å™¨ï¼ˆNS è®°å½•ï¼‰  
```bash  
nslookup -type=NS wikipedia.org  
```  
**è¾“å‡ºç¤ºä¾‹**ï¼š  
```  
wikipedia.org	nameserver = ns0.wikimedia.org.  
wikipedia.org	nameserver = ns1.wikimedia.org.  
```  

### 5. è·å–åŸŸæƒå¨ä¿¡æ¯ï¼ˆSOA è®°å½•ï¼‰  
```bash  
nslookup -type=SOA amazon.com  
```  
**è¾“å‡ºå…³é”®å­—æ®µ**ï¼š  
```  
primary name server = pdns1.ultradns.net  
serial = 2024011501  
refresh = 43200 (12 hours)  
retry = 7200 (2 hours)  
expire = 1209600 (14 days)  
```  

### 6. æŸ¥è¯¢ TXT è®°å½•ï¼ˆéªŒè¯åŸŸåæ‰€æœ‰æƒï¼‰  
```bash  
nslookup -type=TXT github.com  
```  
**è¾“å‡ºç¤ºä¾‹**ï¼š  
```  
github.com	text = "v=spf1 ip4:192.30.252.0/22 include:_spf.google.com ~all"  
```  

---

## äº”ã€é«˜çº§ä½¿ç”¨æŠ€å·§  

### 1. æŒ‡å®š DNS æœåŠ¡å™¨æŸ¥è¯¢  
```bash  
nslookup facebook.com 1.1.1.1  # ä½¿ç”¨ Cloudflare DNS  
```  

### 2. æ‰¹é‡æŸ¥è¯¢åŸŸåè§£æ  
```bash  
echo -e "google.com\naws.com" | xargs -n1 nslookup  
```  

### 3. æ£€æŸ¥ DNS ä¼ æ’­çŠ¶æ€  
```bash  
nslookup mydomain.com 8.8.8.8   # Google DNS  
nslookup mydomain.com 1.1.1.1   # Cloudflare DNS  
```  

---

## å…­ã€å¸¸è§é—®é¢˜æ’æŸ¥æŒ‡å—  

### 1. åŸŸåè§£æå¤±è´¥  
```bash  
nslookup example.com  
# è‹¥è¿”å› "** server can't find example.com: NXDOMAIN"  
# å¯èƒ½åŸå› ï¼šåŸŸåæœªæ³¨å†Œæˆ– DNS æœªç”Ÿæ•ˆ  
```  

### 2. é‚®ä»¶æœåŠ¡å™¨æ•…éšœ  
```bash  
nslookup -type=MX example.com  
# éªŒè¯ MX è®°å½•æ˜¯å¦å­˜åœ¨ä¸”ä¼˜å…ˆçº§æ­£ç¡®  
```  

### 3. CDN é…ç½®éªŒè¯  
```bash  
nslookup assets.example.com  
# æ£€æŸ¥æ˜¯å¦è§£æåˆ° CDN æä¾›çš„ CNAME è®°å½•  
```  

---

## ä¸ƒã€`nslookup` vs `dig` å¯¹æ¯”  

| **ç‰¹æ€§**         | `nslookup`               | `dig`                    |  
|------------------|--------------------------|--------------------------|  
| è¾“å‡ºæ ¼å¼          | ç®€æ´æ˜“è¯»                  | è¯¦ç»†ï¼ˆé€‚åˆè„šæœ¬å¤„ç†ï¼‰       |  
| è°ƒè¯•ä¿¡æ¯          | éœ€ `-debug` é€‰é¡¹          | é»˜è®¤æ˜¾ç¤ºæŸ¥è¯¢è¯¦æƒ…           |  
| å¤šè®°å½•ç±»å‹æŸ¥è¯¢     | æ”¯æŒ                     | æ”¯æŒ                     |  
| åå‘è§£æ          | ç›´æ¥æ”¯æŒ                  | éœ€æŒ‡å®š `-x` é€‰é¡¹          |  

---

## å…«ã€æ³¨æ„äº‹é¡¹  
1. **DNS ç¼“å­˜å½±å“**ï¼šæœ¬åœ° DNS ç¼“å­˜å¯èƒ½å¯¼è‡´æŸ¥è¯¢ç»“æœå»¶è¿Ÿæ›´æ–°ï¼Œä½¿ç”¨ `systemd-resolve --flush-caches` æ¸…ç¼“å­˜  
2. **é˜²ç«å¢™é™åˆ¶**ï¼šç¡®ä¿ UDP/53 å’Œ TCP/53 ç«¯å£å¼€æ”¾  
3. **TTL å€¼**ï¼šæŸ¥è¯¢ç»“æœä¸­çš„ TTLï¼ˆTime To Liveï¼‰è¡¨ç¤ºç¼“å­˜æœ‰æ•ˆæœŸ  

---

é€šè¿‡æŒæ¡ `nslookup` å‘½ä»¤ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š  
1. å¿«é€Ÿè¯Šæ–­åŸŸåè§£æé—®é¢˜  
2. éªŒè¯ DNS è®°å½•é…ç½®å‡†ç¡®æ€§  
3. æ’æŸ¥é‚®ä»¶æœåŠ¡å™¨æ•…éšœ  
4. ç›‘æ§ DNS ç”Ÿæ•ˆçŠ¶æ€  

> **ä¸“ä¸šæç¤º**ï¼šç»“åˆ `whois` å‘½ä»¤å¯è·å–åŸŸåæ³¨å†Œä¿¡æ¯ï¼Œå…¨é¢åˆ†æåŸŸåçŠ¶æ€ã€‚  
> ```bash  
> whois example.com | grep "Expiration Date"  
> ```


# Linux `dig` å‘½ä»¤å®Œå…¨æŒ‡å—ï¼šDNS æŸ¥è¯¢ä¸æ·±åº¦è§£æ  

## ä¸€ã€æ ¸å¿ƒåŠŸèƒ½è§£æ  
`dig`ï¼ˆDomain Information Groperï¼‰æ˜¯ Linux ç³»ç»Ÿä¸­ **ä¸“ä¸šçº§ DNS è¯Šæ–­å·¥å…·**ï¼Œæä¾›æ¯” `nslookup` æ›´è¯¦ç»†çš„ DNS è®°å½•æŸ¥è¯¢èƒ½åŠ›ã€‚æ”¯æŒå…¨ç±»å‹ DNS è®°å½•æŸ¥è¯¢ã€åå‘è§£æã€æ‰¹é‡æ“ä½œç­‰é«˜çº§åŠŸèƒ½ï¼Œæ˜¯ç½‘ç»œç®¡ç†å‘˜æ’æŸ¥ DNS é—®é¢˜çš„é¦–é€‰å·¥å…·ã€‚

---

## äºŒã€å®‰è£…æ–¹æ³•  

### 1. ä¸»æµå‘è¡Œç‰ˆå®‰è£…å‘½ä»¤  
| ç³»ç»Ÿç±»å‹                | å®‰è£…å‘½ä»¤                    |  
|-------------------------|---------------------------|  
| Debian/Ubuntu/Mint      | `sudo apt-get install dnsutils` |  
| RHEL/CentOS/Fedora      | `sudo yum install bind-utils`   |  

### 2. éªŒè¯å®‰è£…  
```bash  
dig -v  # è¾“å‡ºç¤ºä¾‹ï¼šdig 9.16.1  
```  

---

## ä¸‰ã€å‘½ä»¤è¯­æ³•ä¸å¸¸ç”¨é€‰é¡¹  

### 1. åŸºç¡€è¯­æ³•æ ¼å¼  
```bash  
dig [@DNSæœåŠ¡å™¨] [åŸŸå/IP] [è®°å½•ç±»å‹] [é€‰é¡¹]  
```  

### 2. æ ¸å¿ƒé€‰é¡¹é€ŸæŸ¥è¡¨  

| é€‰é¡¹               | åŠŸèƒ½æè¿°                          |  
|--------------------|-----------------------------------|  
| `+short`           | ç®€åŒ–è¾“å‡ºï¼ˆä»…æ˜¾ç¤ºå…³é”®ç»“æœï¼‰          |  
| `+nocomments`      | å»é™¤æ³¨é‡Šä¿¡æ¯                      |  
| `+noall`           | å…³é—­æ‰€æœ‰é»˜è®¤è¾“å‡º                  |  
| `+answer`          | ä»…æ˜¾ç¤ºç­”æ¡ˆéƒ¨åˆ†                    |  
| `+trace`           | è·Ÿè¸ª DNS è§£æè·¯å¾„ï¼ˆé€çº§æŸ¥è¯¢ï¼‰      |  
| `+stats`           | æ˜¾ç¤ºæŸ¥è¯¢ç»Ÿè®¡ä¿¡æ¯                  |  
| `-x IPåœ°å€`        | åå‘ DNS æŸ¥è¯¢ï¼ˆIPâ†’åŸŸåï¼‰          |  
| `-f æ–‡ä»¶å`        | æ‰¹é‡æŸ¥è¯¢æ–‡ä»¶ä¸­çš„åŸŸå              |  

---

## å››ã€å®æˆ˜æ¡ˆä¾‹æ¼”ç¤º  

### 1. åŸºç¡€ A è®°å½•æŸ¥è¯¢  
```bash  
dig google.com A  
```  
**è¾“å‡ºå…³é”®å­—æ®µ**ï¼š  
```  
;; ANSWER SECTION:  
google.com.		299	IN	A	142.250.194.142  
```  

### 2. ç®€åŒ–è¾“å‡ºæ¨¡å¼  
```bash  
dig google.com +short  
# è¾“å‡ºï¼š142.250.194.142  
```  

### 3. æŸ¥è¯¢é‚®ä»¶æœåŠ¡å™¨ï¼ˆMX è®°å½•ï¼‰  
```bash  
dig gmail.com MX +noall +answer  
```  
**è¾“å‡ºç¤ºä¾‹**ï¼š  
```  
gmail.com.		3600	IN	MX	5 gmail-smtp-in.l.google.com.  
```  

### 4. å…¨è®°å½•ç±»å‹æŸ¥è¯¢  
```bash  
dig google.com ANY  
```  
**åŒ…å«è®°å½•ç±»å‹**ï¼šA, AAAA, NS, SOA, MX, TXT ç­‰  

### 5. åå‘ DNS è§£æ  
```bash  
dig -x 8.8.8.8 +short  
# è¾“å‡ºï¼šdns.google.  
```  

### 6. è·Ÿè¸ª DNS è§£æè·¯å¾„  
```bash  
dig +trace example.com  
```  
**è§£ææµç¨‹**ï¼š  
```  
. â†’ com. â†’ example.com. â†’ www.example.com.  
```  

### 7. æŒ‡å®š DNS æœåŠ¡å™¨æŸ¥è¯¢  
```bash  
dig @1.1.1.1 cloudflare.com  
```  

### 8. æ‰¹é‡åŸŸåæŸ¥è¯¢  
```bash  
echo -e "baidu.com\naliyun.com" > domains.txt  
dig -f domains.txt +short  
```  

---

## äº”ã€é«˜çº§ä½¿ç”¨æŠ€å·§  

### 1. æŸ¥è¯¢ TTL å€¼åˆ†æç¼“å­˜  
```bash  
dig google.com +nocmd +nocomments +ttlid  
```  
**è¾“å‡ºå…³é”®å­—æ®µ**ï¼š  
```  
google.com.		299	IN	A	142.250.194.142  
```  

### 2. éªŒè¯ DNSSEC é…ç½®  
```bash  
dig +dnssec google.com DS  
```  

### 3. æ£€æŸ¥ CDN èŠ‚ç‚¹åˆ†å¸ƒ  
```bash  
dig +short www.amazon.com CNAME  
# è¾“å‡ºï¼šd3ag4hukx62yhg.cloudfront.net.  
```  

---

## å…­ã€`dig` vs `nslookup` åŠŸèƒ½å¯¹æ¯”  

| **åŠŸèƒ½**          | `dig`                    | `nslookup`               |  
|-------------------|--------------------------|--------------------------|  
| è¾“å‡ºè¯¦ç»†ç¨‹åº¦       | é«˜ï¼ˆå«æŸ¥è¯¢å…ƒæ•°æ®ï¼‰        | åŸºç¡€ä¿¡æ¯                  |  
| æ‰¹é‡æŸ¥è¯¢æ”¯æŒ       | âœ… `-f` å‚æ•°             | âŒ                        |  
| DNS è§£æè·¯å¾„è·Ÿè¸ª   | âœ… `+trace`              | âŒ                        |  
| ç»“æœæ ¼å¼åŒ–æ§åˆ¶     | âœ… å¤šé€‰é¡¹æ”¯æŒ             | âŒ                        |  
| åå‘è§£ææ“ä½œ       | âœ… `-x`                  | âœ…                        |  

---

## ä¸ƒã€å¸¸è§é—®é¢˜æ’æŸ¥æŒ‡å—  

### 1. è§£æè¶…æ—¶  
```bash  
dig +time=5 google.com  # è®¾ç½®è¶…æ—¶ä¸º5ç§’  
```  

### 2. æ£€æŸ¥ DNS æ±¡æŸ“  
```bash  
dig @8.8.8.8 facebook.com  # ä½¿ç”¨å¯ä¿¡ DNS éªŒè¯  
```  

### 3. éªŒè¯ DNS è®°å½•ä¼ æ’­  
```bash  
dig google.com NS @a.iana-servers.net  # æŸ¥è¯¢æ ¹æƒå¨æœåŠ¡å™¨  
```  

---

## å…«ã€æ‰©å±•åº”ç”¨åœºæ™¯  

### 1. ç›‘æ§ DNS å˜æ›´  
```bash  
watch -n 60 "dig example.com A +short"  # æ¯åˆ†é’Ÿæ£€æŸ¥ A è®°å½•  
```  

### 2. ç”Ÿæˆ DNS å®¡è®¡æŠ¥å‘Š  
```bash  
dig example.com ANY +nocmd +nocomments > dns_audit.log  
```  

### 3. è‡ªåŠ¨åŒ–è„šæœ¬é›†æˆ  
```bash  
#!/bin/bash  
DOMAIN=$1  
if dig $DOMAIN +short | grep -q "1.2.3.4"; then  
    echo "DNSé…ç½®æ­£å¸¸"  
else  
    echo "DNSå¼‚å¸¸ï¼"  
fi  
```  

---

é€šè¿‡æŒæ¡ `dig` å‘½ä»¤ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š  
1. æ·±åº¦è¯Šæ–­å¤æ‚ DNS é—®é¢˜  
2. å¿«é€ŸéªŒè¯åŸŸåè§£æé…ç½®  
3. åˆ†æ CDN å’Œè´Ÿè½½å‡è¡¡ç­–ç•¥  
4. å®ç°è‡ªåŠ¨åŒ–ç½‘ç»œç›‘æ§  

> **ä¸“ä¸šæç¤º**ï¼šç»“åˆ `whois` å‘½ä»¤å¯è¿›è¡Œå…¨é¢çš„åŸŸåå¥åº·æ£€æŸ¥ï¼š  
> ```bash  
> dig example.com +short && whois example.com | grep "Expiration Date"  
> ```


# Linux `host` å‘½ä»¤å®Œå…¨æŒ‡å—ï¼šDNS æŸ¥è¯¢ä¸å®æˆ˜è§£æ  

## ä¸€ã€æ ¸å¿ƒåŠŸèƒ½è§£æ  
`host` æ˜¯ Linux ç³»ç»Ÿä¸­ç”¨äº **DNS æŸ¥è¯¢** çš„è½»é‡çº§å·¥å…·ï¼Œæ”¯æŒåŸŸåä¸ IP åœ°å€çš„äº’æŸ¥æ“ä½œã€‚ç›¸æ¯” `dig` å’Œ `nslookup`ï¼Œ`host` æä¾›æ›´ç®€æ´çš„è¾“å‡ºæ ¼å¼ï¼Œé€‚åˆå¿«é€Ÿè·å–åŸŸåè§£æä¿¡æ¯ã€‚

---

## äºŒã€å‘½ä»¤è¯­æ³•ä¸å®‰è£…éªŒè¯  

### 1. åŸºç¡€è¯­æ³•æ ¼å¼  
```bash  
host [é€‰é¡¹] [åŸŸå/IP] [DNSæœåŠ¡å™¨]  
```  

### 2. å®‰è£…éªŒè¯  
ä¸»æµ Linux å‘è¡Œç‰ˆé»˜è®¤é¢„è£…ï¼ŒéªŒè¯å®‰è£…ï¼š  
```bash  
host -V  # è¾“å‡ºç¤ºä¾‹ï¼šhost 9.16.1  
```  

---

## ä¸‰ã€æ ¸å¿ƒé€‰é¡¹é€ŸæŸ¥è¡¨  

| é€‰é¡¹             | åŠŸèƒ½æè¿°                          |  
|------------------|-----------------------------------|  
| `-a`             | æ˜¾ç¤ºå®Œæ•´ DNS è®°å½•ï¼ˆç­‰åŒäº `-v`ï¼‰   |  
| `-t <è®°å½•ç±»å‹>`  | æŒ‡å®šæŸ¥è¯¢çš„ DNS è®°å½•ç±»å‹            |  
| `-C`             | å¯¹æ¯”æƒå¨ DNS çš„ SOA è®°å½•          |  
| `-R <é‡è¯•æ¬¡æ•°>`  | è®¾ç½® DNS æŸ¥è¯¢é‡è¯•æ¬¡æ•°              |  
| `-l`             | åˆ—å‡ºåŸŸå†…æ‰€æœ‰ä¸»æœºï¼ˆéœ€ç®¡ç†å‘˜æƒé™ï¼‰    |  
| `-W <è¶…æ—¶ç§’æ•°>`  | è®¾ç½®æŸ¥è¯¢è¶…æ—¶æ—¶é—´                  |  

---

## å››ã€å®æˆ˜æ¡ˆä¾‹æ¼”ç¤º  

### 1. åŸºç¡€åŸŸåè§£æ  
```bash  
host google.com  
```  
**è¾“å‡ºç¤ºä¾‹**ï¼š  
```  
google.com has address 142.250.194.142  
google.com has IPv6 address 2404:6800:4005:810::200e  
```  

### 2. IP åå‘è§£æ  
```bash  
host 142.250.194.142  
```  
**è¾“å‡ºç¤ºä¾‹**ï¼š  
```  
142.194.250.142.in-addr.arpa domain name pointer fra24s01-in-f14.1e100.net.  
```  

### 3. æŸ¥è¯¢æŒ‡å®šè®°å½•ç±»å‹  
```bash  
host -t MX gmail.com  
```  
**è¾“å‡ºç‰‡æ®µ**ï¼š  
```  
gmail.com mail is handled by 5 gmail-smtp-in.l.google.com.  
```  

### 4. å®Œæ•´è®°å½•æŸ¥è¯¢ï¼ˆè¯¦ç»†æ¨¡å¼ï¼‰  
```bash  
host -a wikipedia.org  
```  
**åŒ…å«å†…å®¹**ï¼š  
```  
;; ANSWER SECTION:  
wikipedia.org.		3600	IN	AAAA	2620:0:860:ed1a::1  
wikipedia.org.		1800	IN	NS	ns1.wikimedia.org.  
```  

### 5. æƒå¨ DNS ä¸€è‡´æ€§æ£€æŸ¥  
```bash  
host -C example.com  
```  
**è¾“å‡ºå…³é”®å­—æ®µ**ï¼š  
```  
SOA record from ns1.example.com and ns2.example.com match  
```  

### 6. æ‰¹é‡ä¸»æœºåˆ—è¡¨ï¼ˆéœ€æƒé™ï¼‰  
```bash  
host -l example.com ns1.example.com  
```  

---

## äº”ã€é«˜çº§ä½¿ç”¨æŠ€å·§  

### 1. æŒ‡å®š DNS æœåŠ¡å™¨æŸ¥è¯¢  
```bash  
host facebook.com 8.8.8.8  # ä½¿ç”¨ Google DNS  
```  

### 2. æ£€æµ‹ DNS ä¼ æ’­çŠ¶æ€  
```bash  
host -W 3 mynewdomain.com  # è®¾ç½®3ç§’è¶…æ—¶  
```  

### 3. è‡ªåŠ¨åŒ–è„šæœ¬é›†æˆ  
```bash  
#!/bin/bash  
DOMAIN=$1  
if host -t A $DOMAIN | grep "has address"; then  
    echo "$DOMAIN è§£ææ­£å¸¸"  
else  
    echo "è§£æå¤±è´¥ï¼"  
fi  
```  

---

## å…­ã€`host` vs `dig` vs `nslookup`  

| **ç‰¹æ€§**         | `host`                | `dig`                  | `nslookup`             |  
|------------------|-----------------------|------------------------|------------------------|  
| è¾“å‡ºè¯¦ç»†ç¨‹åº¦       | ç®€æ´                  | è¯¦ç»†                    | ä¸­ç­‰                   |  
| åå‘è§£ææ”¯æŒ       | âœ…                    | âœ…                      | âœ…                     |  
| è®°å½•ç±»å‹æŸ¥è¯¢       | âœ… `-t` é€‰é¡¹          | âœ…                      | âœ…                     |  
| æ‰¹é‡æ“ä½œèƒ½åŠ›       | âŒ                    | âœ… `-f` å‚æ•°            | âŒ                     |  
| å­¦ä¹ æ›²çº¿          | ç®€å•                  | ä¸­ç­‰                    | ç®€å•                   |  

---

## ä¸ƒã€å¸¸è§é—®é¢˜æ’æŸ¥  

### 1. è§£æè¶…æ—¶  
```bash  
host -W 5 slowdomain.com  # è®¾ç½®5ç§’è¶…æ—¶  
```  

### 2. SOA è®°å½•ä¸ä¸€è‡´  
```bash  
host -C conflictdomain.com  
```  

### 3. CDN èŠ‚ç‚¹éªŒè¯  
```bash  
host -t CNAME assets.example.com  
```  

---

## å…«ã€æ‰©å±•åº”ç”¨åœºæ™¯  

### 1. ç›‘æ§åŸŸåè§£æå¥åº·  
```bash  
watch -n 60 "host -t A monitor.example.com"  
```  

### 2. ç”Ÿæˆ DNS å®¡è®¡æŠ¥å‘Š  
```bash  
host -a example.com > dns_audit.log  
```  

### 3. æ’æŸ¥é‚®ä»¶æœåŠ¡å™¨æ•…éšœ  
```bash  
host -t MX example.com | grep "mail is handled by"  
```  

---

é€šè¿‡æŒæ¡ `host` å‘½ä»¤ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š  
1. å¿«é€Ÿè¯Šæ–­åŸºç¡€ DNS é—®é¢˜  
2. éªŒè¯åŸŸåè§£æé…ç½®  
3. æ£€æŸ¥ DNS è®°å½•ä¸€è‡´æ€§  
4. å®ç°è½»é‡çº§ç½‘ç»œç›‘æ§  


# Linux `netstat` å‘½ä»¤å®Œå…¨æŒ‡å—ï¼šç½‘ç»œçŠ¶æ€æ·±åº¦è§£æ

## ä¸€ã€æ ¸å¿ƒåŠŸèƒ½è§£æ
`netstat`ï¼ˆnetwork statisticsï¼‰æ˜¯ Linux ç³»ç»Ÿ **ç½‘ç»œçŠ¶æ€ç›‘æ§ç¥å™¨**ï¼Œå¯å±•ç¤ºï¼š  
âœ… å®æ—¶ç½‘ç»œè¿æ¥çŠ¶æ€  
âœ… è·¯ç”±è¡¨ä¿¡æ¯  
âœ… æ¥å£ç»Ÿè®¡ä¿¡æ¯  
âœ… åè®®çº§æ•°æ®åŒ…ç»Ÿè®¡  
âœ… è¿›ç¨‹ä¸ç«¯å£çš„å…³è”å…³ç³»  

![netstat åŠŸèƒ½ç¤ºæ„å›¾](https://mermaid.ink/svg/eyJjb2RlIjoiZ3JhcGggVERcbiAgICBBW25ldHN0YXQgY29tbWFuZF0gLS0-fFRDUC9VRFAgU3RhdHVzfCBCW0Nvbm5lY3Rpb25zXU5ld3dvcmvihKJdXG4gICAgQVtOZXRzdGF0X0NvbW1hbmRdIC0tPnxSb3V0aW5nfCBDW1JvdXRlIFRhYmxlXVxuICAgIEFbTmV0c3RhdF9Db21tYW5kXSAtLT58SW50ZXJmYWNlfCBFW0ludGVyZmFjZSBTdGF0c11cbiAgICBBW05ldHN0YXRfQ29tbWFuZF0gLS0-fFByb2Nlc3N8IEZbUElEICsgUHJvZ3JhbV0iLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9fQ)

---

## äºŒã€å‘½ä»¤è¯­æ³•ä¸æ ¸å¿ƒå‚æ•°é€ŸæŸ¥è¡¨

### åŸºç¡€è¯­æ³•æ ¼å¼
```bash
netstat [é€‰é¡¹ç»„åˆ]
```

### å‚æ•°åŠŸèƒ½å¯¹ç…§è¡¨

| å‚æ•° | åŠŸèƒ½æè¿°                         | å¸¸ç”¨ç»„åˆç¤ºä¾‹         |
|------|----------------------------------|---------------------|
| `-a` | æ˜¾ç¤ºæ‰€æœ‰è¿æ¥ï¼ˆå«ç›‘å¬ï¼‰            | `netstat -a`        |
| `-t` | ä»…æ˜¾ç¤ºTCPåè®®è¿æ¥                | `netstat -at`       |
| `-u` | ä»…æ˜¾ç¤ºUDPåè®®è¿æ¥                | `netstat -au`       |
| `-l` | ä»…æ˜¾ç¤ºç›‘å¬çŠ¶æ€ç«¯å£               | `netstat -l`        |
| `-p` | æ˜¾ç¤ºè¿›ç¨‹PIDå’Œç¨‹åºå             | `netstat -pt`       |
| `-n` | æ•°å­—å½¢å¼æ˜¾ç¤ºåœ°å€å’Œç«¯å£å·         | `netstat -tnlp`     |
| `-r` | æ˜¾ç¤ºå†…æ ¸è·¯ç”±è¡¨                  | `netstat -r`        |
| `-s` | æ˜¾ç¤ºåè®®çº§ç»Ÿè®¡ä¿¡æ¯              | `netstat -s`        |
| `-c` | æŒç»­åˆ·æ–°è¾“å‡º                    | `netstat -ct`       |
| `-i` | æ˜¾ç¤ºç½‘ç»œæ¥å£ä¿¡æ¯                | `netstat -i`        |

---

## ä¸‰ã€å®æˆ˜åœºæ™¯ä¸å‘½ä»¤ç¤ºä¾‹

### åœºæ™¯1ï¼šå®æ—¶ç›‘æ§ç½‘ç»œè¿æ¥
```bash
netstat -tunap
```
```text
Proto Recv-Q Send-Q Local Address  Foreign Address    State       PID/Program
tcp   0      0      192.168.1.5:22 203.0.113.12:54321 ESTABLISHED 1234/sshd
```

### åœºæ™¯2ï¼šæŸ¥çœ‹ç›‘å¬ç«¯å£è¯¦æƒ…
```bash
netstat -tlnp
```
```text
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address   Foreign Address  State    PID/Program
tcp        0      0 0.0.0.0:80      0.0.0.0:*        LISTEN   456/nginx
```

### åœºæ™¯3ï¼šUDPåè®®æ·±åº¦åˆ†æ
```bash
netstat -su
```
```text
UDP:
    125489 packets received
    23415 packets to unknown port
    0 packet receive errors
```

---

## å››ã€ç½‘ç»œçŠ¶æ€æ·±åº¦è§£æ

### è¿æ¥çŠ¶æ€ç±»å‹è¯´æ˜

| çŠ¶æ€          | æè¿°                          |
|---------------|------------------------------|
| LISTEN        | ç­‰å¾…è¿œç¨‹è¿æ¥è¯·æ±‚              |
| ESTABLISHED   | å·²å»ºç«‹çš„è¿æ¥                  |
| TIME_WAIT     | ç­‰å¾…å¤„ç†æ®‹ç•™æ•°æ®åŒ…            |
| CLOSE_WAIT    | ç­‰å¾…æœ¬åœ°å…³é—­è¯·æ±‚              |
| SYN_SENT      | ä¸»åŠ¨å‘èµ·è¿æ¥è¯·æ±‚              |

---

## äº”ã€ç½‘ç»œæ¥å£ç»Ÿè®¡ä¿¡æ¯

### æ¥å£å…³é”®æŒ‡æ ‡è¯´æ˜
```bash
netstat -ie
```
```text
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>
    RX packets 123456  bytes 234567890 (223.8 MiB)
    TX packets 98765   bytes 123456789 (117.7 MiB)
```

---

## å…­ã€é«˜çº§åº”ç”¨æŠ€å·§

### æŠ€å·§1ï¼šå®šä½å ç”¨ç«¯å£çš„è¿›ç¨‹
```bash
netstat -tlnp | grep :80
```
```text
tcp6  0  0 :::80  :::*  LISTEN  789/nginx
```

### æŠ€å·§2ï¼šæŒç»­ç›‘æ§ç½‘ç»œæ´»åŠ¨
```bash
watch -n 1 "netstat -tunap"
```

### æŠ€å·§3ï¼šè·¯ç”±è¡¨å¯è§†åŒ–
```bash
netstat -rn
```
```text
Destination    Gateway        Genmask         Flags MSS Window  irtt Iface
0.0.0.0        192.168.1.1    0.0.0.0         UG    0 0          0 eth0
192.168.1.0    0.0.0.0        255.255.255.0   U     0 0          0 eth0
```

---

## ä¸ƒã€å¸¸è§é—®é¢˜æ’æŸ¥æŒ‡å—

### é—®é¢˜1ï¼šç«¯å£è¢«å¼‚å¸¸å ç”¨
```bash
netstat -tulnp | grep <ç«¯å£å·>
kill -9 <PID>
```

### é—®é¢˜2ï¼šç½‘ç»œè¿æ¥æ•°å¼‚å¸¸
```bash
netstat -an | awk '/tcp/ {print $6}' | sort | uniq -c
```

### é—®é¢˜3ï¼šè·¯ç”±é…ç½®é”™è¯¯
```bash
netstat -rn
route del default
route add default gw <æ­£ç¡®ç½‘å…³>
```

---

## å…«ã€æ‰©å±•çŸ¥è¯†å›¾è°±

```mermaid
graph LR
A[netstatå‘½ä»¤] --> B[è¿æ¥ç›‘æ§]
A --> C[ç«¯å£ç®¡ç†]
A --> D[è·¯ç”±åˆ†æ]
A --> E[åè®®ç»Ÿè®¡]
B --> F[TCPçŠ¶æ€æœº]
C --> G[æœåŠ¡å®šä½]
D --> H[ç½‘å…³é…ç½®]
E --> I[æµé‡åˆ†æ]
```

é€šè¿‡æŒæ¡`netstat`å‘½ä»¤ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š  
1. å®æ—¶è¯Šæ–­ç½‘ç»œè¿æ¥å¼‚å¸¸  
2. ç²¾å‡†å®šä½ç«¯å£å ç”¨é—®é¢˜  
3. æ·±åº¦åˆ†æç½‘ç»œæµé‡ç‰¹å¾  
4. å¿«é€Ÿæ’æŸ¥è·¯ç”±é…ç½®é”™è¯¯  

> **ä¸“å®¶æç¤º**ï¼šæ–°ç‰ˆLinuxç³»ç»Ÿæ¨èä½¿ç”¨`ss`å‘½ä»¤æ›¿ä»£`netstat`ï¼Œä½†`netstat`ä»æ˜¯è·¨å¹³å°è¯Šæ–­çš„é‡è¦å·¥å…·ã€‚



# Linux `ifconfig` å‘½ä»¤å®Œå…¨æŒ‡å—ï¼šç½‘ç»œæ¥å£æ·±åº¦ç®¡ç†

## ä¸€ã€æ ¸å¿ƒåŠŸèƒ½è§£æ  
`ifconfig`ï¼ˆinterface configuratorï¼‰æ˜¯ Linux ç³»ç»Ÿçš„ **ç½‘ç»œæ¥å£ç®¡ç†ç¥å™¨**ï¼Œå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒèƒ½åŠ›ï¼š  
âœ… å®æ—¶æ˜¾ç¤ºç½‘ç»œæ¥å£çŠ¶æ€  
âœ… é…ç½® IP åœ°å€å’Œç½‘ç»œå‚æ•°  
âœ… ç®¡ç†æ¥å£å¯ç”¨/ç¦ç”¨çŠ¶æ€  
âœ… ä¿®æ”¹ MAC åœ°å€ä¸ MTU å€¼  
âœ… è¯Šæ–­åŸºç¡€ç½‘ç»œè¿æ¥é—®é¢˜  

![ifconfig åŠŸèƒ½ç¤ºæ„å›¾](https://mermaid.ink/svg/eyJjb2RlIjoiZ3JhcGggVERcbiAgICBBW2lmY29uZmlnXSA8LS0-IEJb6K6+572uIOa1j+iniF1cbiAgICBBIDwtLS0gQ1vmlbDmja7ooajnpLpdXG4gICAgQSA8LS0tIERb6L2u5Lu2IOaVsOaNrl1cbiAgICBBIDwtLS0gRVvlj5bmtoDmtY/op4hdXG4gICAgQSA8LS0tIEZbTUFDIOe8lue7hF1cbiAgICBBIDwtLS0gR1tNVFUg6L2u5Lu2XVxuICAgIEEgPC0tLSBIW+WPlua2iOWPmOWKqF0iLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9fQ)

---

## äºŒã€å‘½ä»¤è¯­æ³•ä¸å‚æ•°é€ŸæŸ¥è¡¨

### åŸºç¡€è¯­æ³•æ ¼å¼
```bash
ifconfig [æ¥å£å] [é€‰é¡¹] [å‚æ•°]
```

### å¸¸ç”¨å‚æ•°å¯¹ç…§è¡¨

| å‚æ•°          | åŠŸèƒ½æè¿°                         | ç¤ºä¾‹å‘½ä»¤                 |
|---------------|----------------------------------|-------------------------|
| `-a`          | æ˜¾ç¤ºæ‰€æœ‰æ¥å£ï¼ˆå«ç¦ç”¨çŠ¶æ€ï¼‰        | `ifconfig -a`          |
| `up`          | å¯ç”¨æŒ‡å®šç½‘ç»œæ¥å£                  | `ifconfig eth0 up`     |
| `down`        | ç¦ç”¨æŒ‡å®šç½‘ç»œæ¥å£                  | `ifconfig wlan0 down`  |
| `hw ether`    | ä¿®æ”¹ MAC åœ°å€                     | `ifconfig eth0 hw ether 00:11:22:33:44:55` |
| `netmask`     | è®¾ç½®å­ç½‘æ©ç                       | `ifconfig eth0 netmask 255.255.255.0` |
| `broadcast`   | é…ç½®å¹¿æ’­åœ°å€                      | `ifconfig eth0 broadcast 192.168.1.255` |
| `mtu`         | è°ƒæ•´æœ€å¤§ä¼ è¾“å•å…ƒ                  | `ifconfig eth0 mtu 1500` |
| `promisc`     | å¯ç”¨æ··æ‚æ¨¡å¼                      | `ifconfig eth0 promisc` |

---

## ä¸‰ã€ç½‘ç»œæ¥å£ç®¡ç†å®æˆ˜

### åœºæ™¯1ï¼šæŸ¥çœ‹æ‰€æœ‰æ¥å£çŠ¶æ€
```bash
ifconfig -a
```
```text
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.1.100  netmask 255.255.255.0  broadcast 192.168.1.255
        ether 00:0c:29:78:9a:bc  txqueuelen 1000  (Ethernet)
```

### åœºæ™¯2ï¼šä¸´æ—¶é…ç½®IPåœ°å€
```bash
ifconfig eth0 192.168.1.200 netmask 255.255.255.0 up
```

### åœºæ™¯3ï¼šåˆ›å»ºè™šæ‹Ÿæ¥å£
```bash
ifconfig eth0:0 10.0.0.1/24
```

---

## å››ã€ç½‘ç»œçŠ¶æ€æ·±åº¦è§£æ

### å…³é”®æŒ‡æ ‡è¯´æ˜
| æŒ‡æ ‡             | æè¿°                          |
|------------------|------------------------------|
| RX packets       | æ¥æ”¶æ•°æ®åŒ…æ€»æ•°                |
| TX packets       | å‘é€æ•°æ®åŒ…æ€»æ•°                |
| errors           | é”™è¯¯æ•°æ®åŒ…æ•°é‡                |
| dropped          | ä¸¢å¼ƒæ•°æ®åŒ…æ•°é‡                |
| overruns         | ç¼“å†²åŒºæº¢å‡ºæ¬¡æ•°                |
| carrier          | è½½æ³¢ä¿¡å·ä¸¢å¤±æ¬¡æ•°              |

---

## äº”ã€é«˜çº§ç½‘ç»œé…ç½®æŠ€å·§

### æŠ€å·§1ï¼šæ‰¹é‡é…ç½®æ¥å£å‚æ•°
```bash
ifconfig eth0 192.168.1.100 \
netmask 255.255.255.0 \
broadcast 192.168.1.255 \
mtu 1500 up
```

### æŠ€å·§2ï¼šæµé‡ç›‘æ§
```bash
watch -n 1 "ifconfig eth0 | grep 'RX\|TX'"
```

### æŠ€å·§3ï¼šç½‘ç»œè¯Šæ–­ç»„åˆæŠ€
```bash
ifconfig eth0 down && \
ifconfig eth0 hw ether 00:11:22:33:44:55 && \
ifconfig eth0 up
```

---

## å…­ã€IPåœ°å€ç±»å‹å…¨è§£æ

### å…¬æœ‰IP vs ç§æœ‰IPå¯¹æ¯”è¡¨

| ç±»å‹       | èŒƒå›´                          | å¯è·¯ç”±æ€§      | å…¸å‹åº”ç”¨åœºæ™¯        |
|------------|-------------------------------|---------------|---------------------|
| å…¬æœ‰IP     | å…¨çƒå”¯ä¸€åœ°å€                  | å…¨çƒå¯è®¿é—®     | WebæœåŠ¡å™¨ã€VPNç½‘å…³  |
| ç§æœ‰IP     | 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 | å±€åŸŸç½‘å†…éƒ¨     | å†…ç½‘è®¾å¤‡ã€NASå­˜å‚¨   |

---

## ä¸ƒã€IPåœ°å€æŸ¥è¯¢æ–¹æ³•å¤§å…¨

### å…¬æœ‰IPæŸ¥è¯¢æ–¹æ³•
```bash
curl ifconfig.me
# æˆ–
dig +short myip.opendns.com @resolver1.opendns.com
```

### ç§æœ‰IPæŸ¥è¯¢æ–¹æ³•
```bash
ifconfig | grep 'inet ' | awk '{print $2}'
# æˆ–
hostname -I
```

---

## å…«ã€å¸¸è§é—®é¢˜æ’æŸ¥æŒ‡å—

### é—®é¢˜1ï¼šæ¥å£æ— æ³•å¯ç”¨
```bash
dmesg | grep eth0  # æ£€æŸ¥é©±åŠ¨çŠ¶æ€
ethtool eth0       # éªŒè¯ç‰©ç†è¿æ¥
```

### é—®é¢˜2ï¼šIPåœ°å€å†²çª
```bash
arping -I eth0 192.168.1.100  # æ£€æµ‹åœ°å€å ç”¨
```

### é—®é¢˜3ï¼šç½‘ç»œæ€§èƒ½ä½ä¸‹
```bash
ifconfig eth0 | grep mtu      # æ£€æŸ¥MTUè®¾ç½®
ethtool -k eth0 | grep tso    # éªŒè¯TCPåˆ†æ®µå¸è½½
```

---

## ä¹ã€æ‰©å±•çŸ¥è¯†å›¾è°±

```mermaid
graph TB
A[ifconfigæ ¸å¿ƒåŠŸèƒ½] --> B[åŸºç¡€é…ç½®]
A --> C[çŠ¶æ€ç›‘æ§]
A --> D[é«˜çº§è°ƒä¼˜]
B --> E[IPåœ°å€ç®¡ç†]
B --> F[æ¥å£å¯åœæ§åˆ¶]
C --> G[æµé‡ç»Ÿè®¡]
C --> H[é”™è¯¯åˆ†æ]
D --> I[MTUä¼˜åŒ–]
D --> J[MACåœ°å€å…‹éš†]
```

é€šè¿‡æŒæ¡`ifconfig`å‘½ä»¤ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š  
1. å¿«é€Ÿéƒ¨ç½²ç½‘ç»œæœåŠ¡  
2. ç²¾å‡†è¯Šæ–­è¿æ¥æ•…éšœ  
3. ä¼˜åŒ–ç½‘ç»œä¼ è¾“æ€§èƒ½  
4. å®ç°å¤æ‚ç½‘ç»œæ‹“æ‰‘ç®¡ç†  

> **ä¸“å®¶æç¤º**ï¼šæ–°ç‰ˆLinuxç³»ç»Ÿæ¨èä½¿ç”¨`ip`å‘½ä»¤æ›¿ä»£`ifconfig`ï¼Œä½†`ifconfig`ä»æ˜¯ï¼š  
> âœ… è·¨å¹³å°å…¼å®¹æ€§æœ€ä½³é€‰æ‹©  
> âœ… å¿«é€Ÿè¯Šæ–­çš„åˆ©å™¨  
> âœ… ä¼ ç»Ÿè„šæœ¬ç»´æŠ¤å¿…å¤‡å·¥å…·


# Linux `ip` å‘½ä»¤å®Œå…¨æŒ‡å—ï¼šç½‘ç»œé…ç½®ä¸æ·±åº¦ç®¡ç†

## ä¸€ã€æ ¸å¿ƒåŠŸèƒ½è§£æ  
`ip` æ˜¯ Linux ç³»ç»Ÿçš„ **æ–°ä¸€ä»£ç½‘ç»œç®¡ç†å¥—ä»¶**ï¼Œé›†æˆè·¯ç”±ã€æ¥å£ã€åœ°å€ç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå…¨é¢æ›¿ä»£ä¼ ç»Ÿ `ifconfig`/`route` å·¥å…·ã€‚æ”¯æŒ IPv4/IPv6 åŒåè®®æ ˆï¼Œæä¾›æ›´ç²¾ç»†çš„ç½‘ç»œæ§åˆ¶èƒ½åŠ›ã€‚

```mermaid
graph TB
A[ipå‘½ä»¤ä½“ç³»] --> B[åœ°å€ç®¡ç†]
A --> C[æ¥å£æ§åˆ¶]
A --> D[è·¯ç”±é…ç½®]
A --> E[é‚»å±…è¡¨æ“ä½œ]
B --> F[IPåœ°å€åˆ†é…]
B --> G[å­ç½‘æ©ç è®¾ç½®]
C --> H[æ¥å£å¯ç”¨/ç¦ç”¨]
C --> I[MTUè°ƒæ•´]
D --> J[è·¯ç”±è¡¨ä¿®æ”¹]
D --> K[ç­–ç•¥è·¯ç”±]
E --> L[ARPè¡¨ç»´æŠ¤]
E --> M[NDPåè®®ç®¡ç†]
```

---

## äºŒã€å‘½ä»¤è¯­æ³•ä¸å‚æ•°é€ŸæŸ¥è¡¨

### åŸºç¡€è¯­æ³•æ ¼å¼
```bash
ip [å…¨å±€é€‰é¡¹] å¯¹è±¡ç±»å‹ {æ“ä½œå‘½ä»¤ | help}
```

### æ ¸å¿ƒå¯¹è±¡ç±»å‹å¯¹ç…§è¡¨

| å¯¹è±¡ç±»å‹       | åŠŸèƒ½æè¿°                          | å¸¸ç”¨æ“ä½œå‘½ä»¤          |
|----------------|-----------------------------------|---------------------|
| `address`      | IPåœ°å€ç®¡ç†                        | add/del/show        |
| `link`         | ç½‘ç»œæ¥å£æ§åˆ¶                      | set/show            |
| `route`        | è·¯ç”±è¡¨é…ç½®                        | add/del/show        |
| `neighbor`     | ARP/NDPè¡¨ç®¡ç†                     | add/del/show        |
| `rule`         | ç­–ç•¥è·¯ç”±è§„åˆ™                      | add/del/show        |
| `tunnel`       | éš§é“æ¥å£ç®¡ç†                      | add/change/show     |

---

## ä¸‰ã€ç½‘ç»œæ¥å£æ·±åº¦ç®¡ç†

### 1. æ¥å£çŠ¶æ€æ§åˆ¶
```bash
# å¯ç”¨æ¥å£
ip link set eth0 up

# ç¦ç”¨æ¥å£
ip link set wlan0 down

# è®¾ç½®æ··æ‚æ¨¡å¼
ip link set eth0 promisc on
```

### 2. MTUä¼˜åŒ–é…ç½®
```bash
# æŸ¥çœ‹å½“å‰MTU
ip link show eth0 | grep mtu

# è®¾ç½®MTUä¸º9000ï¼ˆå·¨å‹å¸§ï¼‰
ip link set eth0 mtu 9000
```

### 3. æ¥å£åˆ«åç®¡ç†
```bash
# æ·»åŠ è™šæ‹Ÿæ¥å£
ip link add eth0:0 type dummy

# åˆ é™¤è™šæ‹Ÿæ¥å£
ip link del eth0:0
```

---

## å››ã€IPåœ°å€å…¨åœºæ™¯é…ç½®

### 1. åŸºç¡€åœ°å€åˆ†é…
```bash
# IPv4åœ°å€é…ç½®
ip addr add 192.168.1.100/24 dev eth0

# IPv6åœ°å€é…ç½®
ip -6 addr add 2001:db8::1/64 dev eth0
```

### 2. å¤šIPç»‘å®š
```bash
# ä¸»ä»IPé…ç½®
ip addr add 192.168.1.101/24 dev eth0 label eth0:1
```

### 3. åœ°å€åˆ é™¤ä¸åˆ·æ–°
```bash
# åˆ é™¤æŒ‡å®šIP
ip addr del 192.168.1.100/24 dev eth0

# åˆ·æ–°æ‰€æœ‰ä¸´æ—¶åœ°å€
ip addr flush temporary
```

---

## äº”ã€è·¯ç”±è¡¨é«˜çº§æ“ä½œ

### 1. é™æ€è·¯ç”±é…ç½®
```bash
# æ·»åŠ é»˜è®¤ç½‘å…³
ip route add default via 192.168.1.1

# æŒ‡å®šæ¥å£è·¯ç”±
ip route add 10.0.0.0/24 dev tun0
```

### 2. ç­–ç•¥è·¯ç”±ç¤ºä¾‹
```bash
# åˆ›å»ºè·¯ç”±è¡¨
echo "200 custom" >> /etc/iproute2/rt_tables

# æ·»åŠ ç­–ç•¥è§„åˆ™
ip rule add from 192.168.2.0/24 table custom

# é…ç½®è¡¨å†…è·¯ç”±
ip route add default via 10.0.0.1 table custom
```

### 3. è·¯ç”±ç›‘æ§æŠ€å·§
```bash
# å®æ—¶è·¯ç”±å˜åŒ–ç›‘æ§
ip monitor route
```

---

## å…­ã€ARP/NDPè¡¨é¡¹ç®¡ç†

### 1. ARPè¡¨æ“ä½œ
```bash
# æŸ¥çœ‹ARPç¼“å­˜
ip neighbor show

# æ‰‹åŠ¨æ·»åŠ ARPè®°å½•
ip neighbor add 192.168.1.50 lladdr 00:11:22:33:44:55 dev eth0 nud permanent

# åˆ é™¤æ— æ•ˆæ¡ç›®
ip neighbor flush dev eth0
```

### 2. IPv6é‚»å±…å‘ç°
```bash
# æŸ¥çœ‹NDPè¡¨
ip -6 neighbor show

# åˆ·æ–°IPv6ç¼“å­˜
ip -6 neighbor flush dev eth0
```

---

## ä¸ƒã€ç½‘ç»œè¯Šæ–­ä¸ç›‘æ§

### 1. å®æ—¶æµé‡ç›‘æ§
```bash
# æ¥å£ç»Ÿè®¡ä¿¡æ¯
watch -n 1 "ip -s link show eth0"

# è¯¦ç»†é”™è¯¯åˆ†æ
ip -s -s link show eth0
```

### 2. è·¯ç”±è¿½è¸ªä¼˜åŒ–
```bash
# æŒ‡å®šæºæ¥å£è·¯ç”±è¿½è¸ª
ip route get 8.8.8.8 from 192.168.1.100
```

### 3. ç½‘ç»œå‘½åç©ºé—´
```bash
# åˆ›å»ºç½‘ç»œå‘½åç©ºé—´
ip netns add ns1

# åœ¨å‘½åç©ºé—´ä¸­æ‰§è¡Œå‘½ä»¤
ip netns exec ns1 ip addr show
```

---

## å…«ã€é«˜çº§é…ç½®ç¤ºä¾‹

### 1. VLANé…ç½®
```bash
# åˆ›å»ºVLANæ¥å£
ip link add link eth0 name eth0.100 type vlan id 100

# é…ç½®VLAN IP
ip addr add 192.168.100.2/24 dev eth0.100
```

### 2. ç½‘æ¡¥ç®¡ç†
```bash
# åˆ›å»ºç½‘æ¡¥
ip link add br0 type bridge

# æ·»åŠ æ¥å£åˆ°ç½‘æ¡¥
ip link set eth1 master br0
```

### 3. GREéš§é“å»ºç«‹
```bash
# åˆ›å»ºGREéš§é“
ip tunnel add gre1 mode gre remote 203.0.113.1 local 198.51.100.1 ttl 255

# æ¿€æ´»éš§é“æ¥å£
ip link set gre1 up
```

---

## ä¹ã€æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ

1. **é…ç½®æŒä¹…åŒ–**ï¼šä½¿ç”¨`ip`å‘½ä»¤çš„ä¿®æ”¹å‡ä¸ºä¸´æ—¶ç”Ÿæ•ˆï¼Œéœ€é…åˆç½‘ç»œç®¡ç†å™¨æˆ–å†™å…¥`/etc/network/interfaces`å®ç°æ°¸ä¹…é…ç½®
2. **æƒé™ç®¡ç†**ï¼šå¤šæ•°é…ç½®æ“ä½œéœ€è¦`root`æƒé™ï¼Œå»ºè®®ä½¿ç”¨`sudo`
3. **ç‰ˆæœ¬å…¼å®¹**ï¼šä¸åŒLinuxå‘è¡Œç‰ˆå¯èƒ½éœ€é¢å¤–å®‰è£…`iproute2`åŒ…
4. **æ•…éšœæ’æŸ¥**ï¼šç»“åˆ`ss`ã€`ping`ã€`tcpdump`ç­‰å·¥å…·è¿›è¡Œç»¼åˆè¯Šæ–­

> **ä¸“å®¶æç¤º**ï¼šç”Ÿäº§ç¯å¢ƒä¸­å»ºè®®é€šè¿‡`nmcli`æˆ–`netplan`è¿›è¡Œé…ç½®ç®¡ç†ï¼Œ`ip`å‘½ä»¤æ›´é€‚åˆä¸´æ—¶è°ƒè¯•å’Œé«˜çº§ç½‘ç»œåœºæ™¯

é€šè¿‡æŒæ¡`ip`å‘½ä»¤ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š
1. å®ç°ä¼ä¸šçº§ç½‘ç»œæ¶æ„éƒ¨ç½²
2. å¿«é€Ÿè¯Šæ–­å¤æ‚ç½‘ç»œæ•…éšœ
3. ä¼˜åŒ–ç½‘ç»œæ€§èƒ½å‚æ•°
4. æ„å»ºé«˜çº§ç½‘ç»œæœåŠ¡ç¯å¢ƒ

# Linux `ss` å‘½ä»¤å®Œå…¨æŒ‡å—ï¼šç½‘ç»œå¥—æ¥å­—æ·±åº¦è§£æ

## ä¸€ã€æ ¸å¿ƒåŠŸèƒ½è§£æ  
`ss`ï¼ˆSocket Statisticsï¼‰æ˜¯ Linux ç³»ç»Ÿçš„ **ç½‘ç»œå¥—æ¥å­—è¯Šæ–­åˆ©å™¨**ï¼Œæ›¿ä»£ä¼ ç»Ÿçš„ `netstat` å·¥å…·ã€‚æä¾›æ›´å¿«çš„æ‰§è¡Œé€Ÿåº¦å’Œæ›´è¯¦ç»†çš„ç½‘ç»œè¿æ¥ä¿¡æ¯ï¼Œæ”¯æŒ TCP/UDP/RAW/UNIX åŸŸå¥—æ¥å­—çš„å…¨é¢ç›‘æ§ã€‚

```mermaid
graph TB
A[sså‘½ä»¤ä½“ç³»] --> B[è¿æ¥çŠ¶æ€ç›‘æ§]
A --> C[åè®®ç±»å‹è¿‡æ»¤]
A --> D[é«˜çº§è¿‡æ»¤æ¡ä»¶]
A --> E[æ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡]
B --> F[TCPçŠ¶æ€æœºåˆ†æ]
B --> G[UDPä¼šè¯è¿½è¸ª]
C --> H[IPv4/IPv6åè®®æ ˆ]
D --> I[ç«¯å£/è¿›ç¨‹è¿‡æ»¤]
E --> J[æ•°æ®åŒ…ååç»Ÿè®¡]
```

---

## äºŒã€å‘½ä»¤è¯­æ³•ä¸å‚æ•°é€ŸæŸ¥è¡¨

### åŸºç¡€è¯­æ³•æ ¼å¼
```bash
ss [å…¨å±€é€‰é¡¹] [è¿‡æ»¤æ¡ä»¶]
```

### æ ¸å¿ƒé€‰é¡¹å¯¹ç…§è¡¨

| é€‰é¡¹         | åŠŸèƒ½æè¿°                          | å¸¸ç”¨ç»„åˆç¤ºä¾‹          |
|--------------|----------------------------------|----------------------|
| `-t`         | æ˜¾ç¤º TCP å¥—æ¥å­—                  | `ss -t`             |
| `-u`         | æ˜¾ç¤º UDP å¥—æ¥å­—                  | `ss -u`             |
| `-l`         | æ˜¾ç¤ºç›‘å¬çŠ¶æ€å¥—æ¥å­—                | `ss -lt`            |
| `-a`         | æ˜¾ç¤ºæ‰€æœ‰å¥—æ¥å­—ï¼ˆå«æœªè¿æ¥ï¼‰        | `ss -a`             |
| `-n`         | æ˜¾ç¤ºæ•°å­—åœ°å€ï¼ˆç¦ç”¨DNSè§£æï¼‰        | `ss -nt`            |
| `-p`         | æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯                      | `ss -p`             |
| `-s`         | æ˜¾ç¤ºæ±‡æ€»ç»Ÿè®¡                      | `ss -s`             |
| `-o`         | æ˜¾ç¤ºè®¡æ—¶å™¨ä¿¡æ¯                    | `ss -o`             |
| `-4`         | ä»…æ˜¾ç¤º IPv4 è¿æ¥                 | `ss -4`             |
| `-6`         | ä»…æ˜¾ç¤º IPv6 è¿æ¥                 | `ss -6`             |
| `-i`         | æ˜¾ç¤º TCP å†…éƒ¨ä¿¡æ¯                | `ss -ti`            |

---

## ä¸‰ã€ç½‘ç»œçŠ¶æ€æ·±åº¦ç›‘æ§

### 1. åŸºç¡€è¿æ¥æŸ¥çœ‹
```bash
# æŸ¥çœ‹æ‰€æœ‰TCPè¿æ¥
ss -t

# æŸ¥çœ‹æ‰€æœ‰UDPè¿æ¥
ss -u

# æ˜¾ç¤ºç›‘å¬ç«¯å£
ss -ltn
```

### 2. é«˜çº§è¿‡æ»¤æŠ€å·§
```bash
# æŸ¥çœ‹æŒ‡å®šç«¯å£è¿æ¥ï¼ˆHTTPæœåŠ¡ï¼‰
ss -t sport = :80

# è¿‡æ»¤ç›®æ ‡åœ°å€ï¼ˆè®¿é—®Googleçš„è¿æ¥ï¼‰
ss -t dst 142.250.194.142

# ç»„åˆè¿‡æ»¤æ¡ä»¶ï¼ˆESTABLISHEDçŠ¶æ€çš„SSHè¿æ¥ï¼‰
ss -t state established dport = :22
```

### 3. è¿›ç¨‹å…³è”åˆ†æ
```bash
# æ˜¾ç¤ºå¸¦è¿›ç¨‹ä¿¡æ¯çš„TCPè¿æ¥
ss -tp

# è¿‡æ»¤Nginxè¿›ç¨‹è¿æ¥
ss -tp | grep nginx

# æŸ¥çœ‹æŒ‡å®šPIDçš„è¿æ¥ï¼ˆPID 1234ï¼‰
ss -tp | grep 'pid=1234'
```

---

## å››ã€TCPçŠ¶æ€æœºæ·±åº¦è§£æ

### 1. TCPçŠ¶æ€ç±»å‹
| çŠ¶æ€           | æè¿°                          |
|----------------|------------------------------|
| ESTABLISHED    | å·²å»ºç«‹çš„è¿æ¥                  |
| SYN-SENT       | ä¸»åŠ¨å‘èµ·è¿æ¥è¯·æ±‚              |
| SYN-RECV       | æ”¶åˆ°SYNè¯·æ±‚                   |
| FIN-WAIT-1     | ç­‰å¾…è¿œç¨‹TCPè¿æ¥ç»ˆæ­¢è¯·æ±‚        |
| FIN-WAIT-2     | ç­‰å¾…è¿œç¨‹TCPè¿æ¥ç»ˆæ­¢ç¡®è®¤        |
| TIME-WAIT      | ç­‰å¾…å¤„ç†æ®‹ç•™æ•°æ®åŒ…            |
| CLOSE-WAIT     | ç­‰å¾…æœ¬åœ°å…³é—­è¯·æ±‚              |
| LAST-ACK       | ç­‰å¾…åŸå§‹è¿œç¨‹TCPç»ˆæ­¢ç¡®è®¤        |

### 2. çŠ¶æ€è¿‡æ»¤ç¤ºä¾‹
```bash
# æŸ¥çœ‹TIME-WAITçŠ¶æ€è¿æ¥
ss -t state time-wait

# åˆ†æSYNæ´ªæ°´æ”»å‡»ï¼ˆå¤§é‡SYN-RECVçŠ¶æ€ï¼‰
ss -t state syn-recv | wc -l
```

---

## äº”ã€æ€§èƒ½æŒ‡æ ‡ä¸ç»Ÿè®¡

### 1. è¿æ¥æ•°ç»Ÿè®¡
```bash
# æ˜¾ç¤ºå„çŠ¶æ€TCPè¿æ¥æ•°
ss -s | grep TCP

# UDPæ•°æ®åŒ…ç»Ÿè®¡
ss -us
```

### 2. å®æ—¶ååç›‘æ§
```bash
watch -n 1 "ss -ti | grep -E 'cwnd|rtt'"
```

### 3. è®¡æ—¶å™¨ä¿¡æ¯åˆ†æ
```bash
# æ˜¾ç¤ºTCPé‡ä¼ è®¡æ—¶å™¨
ss -to | grep retrans

# æŸ¥çœ‹keepaliveè®¡æ—¶å™¨
ss -to | grep keepalive
```

---

## å…­ã€ä¼ä¸šçº§åº”ç”¨åœºæ™¯

### 1. WebæœåŠ¡å™¨è¿æ¥åˆ†æ
```bash
# æŸ¥çœ‹æ´»è·ƒHTTPè¿æ¥
ss -t sport = :80 state established

# åˆ†æè¿æ¥æ¥æºåˆ†å¸ƒ
ss -nt dst :80 | awk '{print $5}' | cut -d: -f1 | sort | uniq -c
```

### 2. æ•°æ®åº“è¿æ¥ç®¡ç†
```bash
# ç›‘æ§MySQLè¿æ¥æ•°
ss -t src :3306 | wc -l

# åˆ†æé•¿è¿æ¥çŠ¶æ€
ss -to state established dport = :3306
```

### 3. å®‰å…¨å®¡è®¡åº”ç”¨
```bash
# æ£€æµ‹å¼‚å¸¸å¤–è”
ss -ntp | grep ESTAB | awk '{print $6}' | sort | uniq -c

# å®šä½æ¶æ„è¿›ç¨‹
ss -ntp | grep 54.238.132.1
```

---

## ä¸ƒã€é«˜çº§æŠ€å·§ä¸è„šæœ¬

### 1. å®æ—¶è¿æ¥ç›‘æ§
```bash
watch -n 1 "ss -tunap4"

# å¸¦é¢œè‰²è¾“å‡º
ss -tunap4 | grep --color -E "ESTAB|LISTEN"
```

### 2. è‡ªåŠ¨åŒ–å‘Šè­¦è„šæœ¬
```bash
#!/bin/bash
MAX_CONN=1000
CURRENT_CONN=$(ss -s | grep 'TCP:' | awk '{print $2}')

if [ $CURRENT_CONN -gt $MAX_CONN ]; then
    echo "è­¦æŠ¥ï¼šå½“å‰è¿æ¥æ•° $CURRENT_CONN" | mail -s "è¿æ¥æ•°è¶…é™" admin@example.com
fi
```

### 3. ç½‘ç»œæ‹“æ‰‘åˆ†æ
```bash
# æ˜¾ç¤ºå…¨åŒå·¥è¿æ¥å›¾
ss -t | awk 'NR>1 {print $5" -> "$6}' | sort | uniq
```

---

## å…«ã€æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ

1. **æƒé™è¦æ±‚**ï¼šæŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯éœ€è¦ root æƒé™
2. **æ€§èƒ½å½±å“**ï¼šé«˜é¢‘ç›‘æ§å»ºè®®ä½¿ç”¨`-n`ç¦ç”¨DNSè§£æ
3. **çŠ¶æ€è¿‡æ»¤**ï¼šç»„åˆå¤šä¸ªè¿‡æ»¤æ¡ä»¶æ—¶ä½¿ç”¨`and`è¿ç®—ç¬¦
4. **æŒä¹…ç›‘æ§**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ç»“åˆ`tshark`/`iftop`ä½¿ç”¨
5. **æ•°æ®æ—¶æ•ˆ**ï¼šç»“æœåæ˜ å®æ—¶çŠ¶æ€ï¼Œéå†å²è®°å½•

> **ä¸“å®¶æç¤º**ï¼š`ss`å‘½ä»¤è¾“å‡ºå¯é€šè¿‡`column -t`è¿›è¡Œåˆ—å¯¹é½ä¼˜åŒ–  
> ```bash
> ss -tunap | column -t
> ```

é€šè¿‡æŒæ¡`ss`å‘½ä»¤ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š  
1. å®æ—¶è¯Šæ–­ç½‘ç»œæ‹¥å¡é—®é¢˜  
2. ç²¾å‡†å®šä½å¼‚å¸¸è¿æ¥  
3. ä¼˜åŒ–æœåŠ¡ç«¯æ€§èƒ½å‚æ•°  
4. æ„å»ºæ™ºèƒ½ç½‘ç»œç›‘æ§ä½“ç³»

# Linux `route` å‘½ä»¤å®Œå…¨æŒ‡å—ï¼šè·¯ç”±è¡¨ç®¡ç†ä¸æ·±åº¦è§£æ

## ä¸€ã€æ ¸å¿ƒåŠŸèƒ½è§£æ  
`route` æ˜¯ Linux ç³»ç»Ÿçš„ **ä¼ ç»Ÿè·¯ç”±ç®¡ç†å·¥å…·**ï¼Œç”¨äºæŸ¥çœ‹å’Œæ“ä½œ IP å†…æ ¸è·¯ç”±è¡¨ã€‚è™½ç„¶é€æ¸è¢« `ip route` æ›¿ä»£ï¼Œä½†ä»æ˜¯ç»´æŠ¤æ—§ç³»ç»Ÿçš„å¿…å¤‡å·¥å…·ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š  
âœ… æ˜¾ç¤ºè·¯ç”±è¡¨ä¿¡æ¯  
âœ… æ·»åŠ /åˆ é™¤é™æ€è·¯ç”±  
âœ… é…ç½®é»˜è®¤ç½‘å…³  
âœ… ç®¡ç†ç‰¹å®šä¸»æœº/ç½‘ç»œè·¯ç”±  

![è·¯ç”±è¡¨ç®¡ç†æµç¨‹](https://mermaid.ink/svg/eyJjb2RlIjoiZ3JhcGggVERcbiAgICBBW3JvdXRlIOaTjeS9nF0gLS0-IEJb6K6+572uIOaVsOaNrl1cbiAgICBBIDwtLS0gQ1vmlrnms5XmjIflrprnmoTlj5jph48gXSIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In19)

---

## äºŒã€å®‰è£…ä¸åŸºæœ¬è¯­æ³•

### 1. å®‰è£…æ–¹æ³•
```bash
# Debian/Ubuntu
sudo apt install net-tools

# RHEL/CentOS
sudo yum install net-tools

# Fedora
sudo dnf install net-tools
```

### 2. åŸºç¡€è¯­æ³•æ ¼å¼
```bash
route [é€‰é¡¹] [æ“ä½œå‘½ä»¤] [å‚æ•°]
```

---

## ä¸‰ã€æ ¸å¿ƒå‚æ•°é€ŸæŸ¥è¡¨

| å‚æ•°         | åŠŸèƒ½æè¿°                          | ç¤ºä¾‹å‘½ä»¤                   |
|--------------|----------------------------------|---------------------------|
| `-n`         | æ•°å­—æ ¼å¼æ˜¾ç¤ºåœ°å€                  | `route -n`               |
| `-v`         | æ˜¾ç¤ºè¯¦ç»†è¾“å‡º                      | `route -v`               |
| `add`        | æ·»åŠ è·¯ç”±æ¡ç›®                      | `route add -net 10.0.0.0/24 gw 192.168.1.1` |
| `del`        | åˆ é™¤è·¯ç”±æ¡ç›®                      | `route del default`       |
| `-host`      | æŒ‡å®šä¸»æœºè·¯ç”±                      | `route add -host 192.168.1.100 dev eth0` |
| `-net`       | æŒ‡å®šç½‘ç»œè·¯ç”±                      | `route add -net 10.0.0.0/24 dev eth1` |
| `gw`         | è®¾ç½®ç½‘å…³                          | `route add default gw 192.168.1.1` |
| `reject`     | åˆ›å»ºé˜»å¡è·¯ç”±                      | `route add -host 203.0.113.5 reject` |

---

## å››ã€è·¯ç”±è¡¨æ“ä½œå®æˆ˜

### 1. æŸ¥çœ‹è·¯ç”±è¡¨
```bash
route -n
```
```text
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.1.1     0.0.0.0         UG    600    0        0 wlp0s20
192.168.1.0     0.0.0.0         255.255.255.0   U     600    0        0 wlp0s20
```

### 2. æ·»åŠ é»˜è®¤ç½‘å…³
```bash
sudo route add default gw 192.168.1.1
```

### 3. åˆ›å»ºé™æ€è·¯ç”±
```bash
# æ·»åŠ ç½‘ç»œè·¯ç”±
sudo route add -net 10.0.0.0/24 gw 192.168.1.254

# æ·»åŠ ä¸»æœºè·¯ç”±
sudo route add -host 203.0.113.5 dev eth0
```

### 4. æ‹’ç»ç‰¹å®šæµé‡
```bash
sudo route add -host 54.238.132.1 reject
```
```text
ping 54.238.132.1
connect: Network is unreachable
```

---

## äº”ã€é«˜çº§è·¯ç”±ç®¡ç†

### 1. è·¯ç”±ç¼“å­˜æŸ¥çœ‹
```bash
route -Cn
```
```text
Kernel IP routing cache
Source          Destination     Gateway         Flags Metric Ref    Use Iface
192.168.1.100   142.250.194.142 192.168.1.1     il    0      5        2 wlp0s20
```

### 2. å¤šè·¯ç”±è¡¨æ“ä½œ
```bash
# æŸ¥çœ‹æœ¬åœ°è·¯ç”±è¡¨
ip route show table local

# æŸ¥çœ‹IPv6è·¯ç”±
ip -6 route
```

---

## å…­ã€`route` vs `ip route` å¯¹æ¯”

| **ç‰¹æ€§**         | `route`                  | `ip route`              |
|-------------------|--------------------------|-------------------------|
| å‘½ä»¤å¤æ‚åº¦        | ç®€å•æ˜“è®°                 | è¯­æ³•æ›´çµæ´»               |
| åŠŸèƒ½èŒƒå›´          | åŸºç¡€è·¯ç”±ç®¡ç†             | æ”¯æŒç­–ç•¥è·¯ç”±ã€å¤šè·¯ç”±è¡¨   |
| è¾“å‡ºæ ¼å¼          | ä¼ ç»Ÿè¡¨æ ¼                 | ç»“æ„åŒ–æ˜¾ç¤º               |
| ç³»ç»Ÿå…¼å®¹æ€§        | ä¾èµ–net-toolsåŒ…          | é›†æˆåœ¨iproute2åŒ…         |
| æ¨èä½¿ç”¨åœºæ™¯      | æ—§ç³»ç»Ÿç»´æŠ¤               | æ–°ç³»ç»Ÿé¦–é€‰               |

---

## ä¸ƒã€æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ

1. **æƒé™è¦æ±‚**ï¼šè·¯ç”±ä¿®æ”¹éœ€è¦ root æƒé™
2. **é…ç½®æŒä¹…åŒ–**ï¼š`route` å‘½ä»¤ä¿®æ”¹ä¸ºä¸´æ—¶ç”Ÿæ•ˆï¼Œéœ€å†™å…¥ `/etc/network/interfaces` æˆ–ä½¿ç”¨ `netplan` å®ç°æ°¸ä¹…é…ç½®
3. **ç½‘å…³éªŒè¯**ï¼šæ·»åŠ è·¯ç”±å‰ç¡®ä¿ç½‘å…³å¯è¾¾
4. **åˆ é™¤è·¯ç”±**ï¼šç²¾ç¡®åŒ¹é…åˆ é™¤å‚æ•°ï¼Œé¿å…è¯¯åˆ 
5. **ç”Ÿäº§ç¯å¢ƒ**ï¼šå»ºè®®åœ¨ç»´æŠ¤çª—å£æ“ä½œï¼Œé…ç½®å‰å¤‡ä»½è·¯ç”±è¡¨

---

## å…«ã€æ•…éšœæ’æŸ¥ç¤ºä¾‹

### åœºæ™¯ï¼šé»˜è®¤ç½‘å…³ä¸¢å¤±
```bash
# æŸ¥çœ‹å½“å‰è·¯ç”±
route -n

# ä¸´æ—¶æ¢å¤ç½‘å…³
sudo route add default gw 192.168.1.1

# æ°¸ä¹…ä¿®å¤ï¼ˆUbuntuç¤ºä¾‹ï¼‰
sudo nano /etc/netplan/01-netcfg.yaml
# æ·»åŠ ï¼š
#   routes:
#     - to: default
#       via: 192.168.1.1
sudo netplan apply
```

---

é€šè¿‡æŒæ¡ `route` å‘½ä»¤ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š  
1. å¿«é€Ÿè¯Šæ–­ç½‘ç»œè¿é€šæ€§é—®é¢˜  
2. å®ç°è‡ªå®šä¹‰æµé‡è·¯ç”±ç­–ç•¥  
3. ç»´æŠ¤ä¼ ç»ŸLinuxç³»ç»Ÿç½‘ç»œé…ç½®  
4. ç†è§£ç°ä»£ `ip route` å‘½ä»¤çš„åŸºç¡€åŸç†  

> **ä¸“å®¶æç¤º**ï¼šæ–°ç³»ç»Ÿå»ºè®®ä¼˜å…ˆä½¿ç”¨ `ip route` å‘½ä»¤ï¼Œå…¶è¯­æ³•æ›´å¼ºå¤§ä¸”å…¼å®¹æ€§æ›´å¥½ï¼š  
> ```bash
> # ç­‰æ•ˆroute -n
> ip route show
> ```


# Linux `traceroute` å‘½ä»¤å®Œå…¨æŒ‡å—ï¼šç½‘ç»œè·¯å¾„è¿½è¸ªä¸æ·±åº¦è¯Šæ–­

## ä¸€ã€æ ¸å¿ƒåŠŸèƒ½è§£æ  
`traceroute` æ˜¯ Linux ç³»ç»Ÿçš„ **ç½‘ç»œè·¯å¾„è¿½è¸ªç¥å™¨**ï¼Œé€šè¿‡å‘é€ UDP/TCP/ICMP æ•°æ®åŒ…ï¼Œé€è·³æ¢æµ‹ç½‘ç»œè·¯å¾„ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š  
âœ… æ˜¾ç¤ºæ•°æ®åŒ…ä¼ è¾“è·¯å¾„  
âœ… å®šä½ç½‘ç»œç“¶é¢ˆèŠ‚ç‚¹  
âœ… æµ‹é‡èŠ‚ç‚¹é—´å»¶è¿Ÿ  
âœ… è¯Šæ–­è·¯ç”±é…ç½®é—®é¢˜  
âœ… åˆ†æç½‘ç»œæ‹“æ‰‘ç»“æ„  

![traceroute å·¥ä½œæµç¨‹](https://mermaid.ink/svg/eyJjb2RlIjoiZ3JhcGggVERcbiAgICBBW3RyYWNlcm91dGUg5omL5py6XSAtLT4gQltVREQvVENQL0lDTVAg5pak5bC05LitXSAtLT4gQ1vmlrDnq5nnianmkJzntKIpXSAvLyBUVEwg5L2N572uIC0tPiBEW+WPlua2iOiMg+WIl11cbiAgICBFW+WIm+W7uuiBlOe9kSAtLT4gRltubWFwIOaKpeWQjeWIl+ihqF0iLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9fQ)

---

## äºŒã€å‘½ä»¤è¯­æ³•ä¸å‚æ•°é€ŸæŸ¥è¡¨

### åŸºç¡€è¯­æ³•æ ¼å¼
```bash
traceroute [é€‰é¡¹] ç›®æ ‡åœ°å€
```

### æ ¸å¿ƒå‚æ•°å¯¹ç…§è¡¨

| å‚æ•°        | åŠŸèƒ½æè¿°                          | ç¤ºä¾‹å‘½ä»¤                    |
|-------------|----------------------------------|----------------------------|
| `-4`        | å¼ºåˆ¶ä½¿ç”¨IPv4åè®®                  | `traceroute -4 google.com` |
| `-6`        | å¼ºåˆ¶ä½¿ç”¨IPv6åè®®                  | `traceroute -6 google.com` |
| `-F`        | ç¦ç”¨æ•°æ®åŒ…åˆ†ç‰‡                    | `traceroute -F 8.8.8.8`   |
| `-f TTL`    | è®¾ç½®èµ·å§‹TTLå€¼                    | `traceroute -f 5 baidu.com` |
| `-m MAX`    | è®¾ç½®æœ€å¤§è·³æ•°ï¼ˆé»˜è®¤30ï¼‰            | `traceroute -m 15 163.com` |
| `-n`        | ç¦ç”¨DNSåå‘è§£æ                  | `traceroute -n aliyun.com` |
| `-p PORT`   | æŒ‡å®šç›®æ ‡ç«¯å£                     | `traceroute -p 443 taobao.com` |
| `-q NUM`    | è®¾ç½®æ¯è·³æ¢æµ‹æ¬¡æ•°ï¼ˆé»˜è®¤3ï¼‰         | `traceroute -q 5 jd.com`  |
| `-w SEC`    | è®¾ç½®ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰            | `traceroute -w 2 weibo.com` |
| `--help`    | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯                     | `traceroute --help`       |

---

## ä¸‰ã€å®æˆ˜åœºæ™¯ä¸å‘½ä»¤ç¤ºä¾‹

### åœºæ™¯1ï¼šåŸºç¡€è·¯å¾„è¿½è¸ª
```bash
traceroute www.baidu.com
```
```text
traceroute to www.baidu.com (14.119.104.254), 30 hops max
 1  192.168.1.1  1.234ms  1.123ms  0.987ms
 2  10.88.32.1  5.678ms  5.432ms  5.210ms
 3  202.96.128.86  12.345ms  11.987ms  11.654ms
 ...
```

### åœºæ™¯2ï¼šæŒ‡å®šåè®®ç±»å‹
```bash
# IPv4è¿½è¸ª
traceroute -4 www.taobao.com

# IPv6è¿½è¸ª
traceroute -6 ipv6.google.com
```

### åœºæ™¯3ï¼šé«˜çº§è¯Šæ–­é…ç½®
```bash
# ç¦ç”¨åˆ†ç‰‡+é™åˆ¶è·³æ•°
traceroute -F -m 10 www.jd.com

# æŒ‡å®šæºç«¯å£+å¿«é€Ÿæ¢æµ‹
traceroute -p 443 -q 1 www.163.com
```

---

## å››ã€è¾“å‡ºè§£æä¸å…³é”®æŒ‡æ ‡

### å…¸å‹è¾“å‡ºç»“æ„è§£æ
```text
è·³æ•° | èŠ‚ç‚¹IP/ä¸»æœºå | ä¸‰æ¬¡æ¢æµ‹å»¶è¿Ÿï¼ˆmsï¼‰
1    gateway (192.168.1.1)  0.521  0.498  0.487
2    10.88.32.1             5.2    5.1    5.3
3    *  *  *                ï¼ˆè¯·æ±‚è¶…æ—¶ï¼‰
```

### å…³é”®çŠ¶æ€è¯´æ˜
| ç¬¦å·/ç°è±¡        | å«ä¹‰è¯´æ˜                          |
|------------------|----------------------------------|
| `* * *`          | èŠ‚ç‚¹æœªå“åº”ICMP Time Exceededæ¶ˆæ¯  |
| å»¶è¿Ÿçªç„¶å¢åŠ        | å¯èƒ½é‡åˆ°ç½‘ç»œæ‹¥å¡æˆ–è·¨å¢ƒé“¾è·¯         |
| æŒç»­é«˜å»¶è¿Ÿ        | å¯èƒ½ä¸ºå«æ˜Ÿé“¾è·¯æˆ–ä½è´¨é‡ç½‘ç»œè¿æ¥     |
| TTLå€¼ä¸è¿ç»­       | å­˜åœ¨éå¯¹ç§°è·¯ç”±æˆ–é˜²ç«å¢™ç­–ç•¥         |

---

## äº”ã€é«˜çº§è¯Šæ–­æŠ€å·§

### 1. è·¯å¾„å¯¹æ¯”åˆ†æ
```bash
# åŒæ—¶è¿½è¸ªIPv4/IPv6è·¯å¾„
traceroute -4 www.example.com > ipv4.log
traceroute -6 www.example.com > ipv6.log
diff ipv4.log ipv6.log
```

### 2. MTRå®æ—¶ç›‘æ§
```bash
# å®‰è£…MTRå·¥å…·
sudo apt install mtr

# å®æ—¶è·¯å¾„ç›‘æ§
mtr -n --report www.google.com
```

### 3. ç»“åˆtcpdumpæŠ“åŒ…
```bash
# åœ¨åå°å¯åŠ¨æŠ“åŒ…
sudo tcpdump -i eth0 -w trace.pcap &

# æ‰§è¡Œtraceroute
traceroute www.bing.com

# åœæ­¢æŠ“åŒ…å¹¶åˆ†æ
fg  # æŒ‰Ctrl+Cç»ˆæ­¢
wireshark trace.pcap
```

---

## å…­ã€ä¼ä¸šçº§åº”ç”¨åœºæ™¯

### åœºæ™¯1ï¼šè·¨å›½ä¸“çº¿è´¨é‡æ£€æµ‹
```bash
traceroute -m 25 -q 5 -w 3 overseas-node.example.com
```

### åœºæ™¯2ï¼šCDNèŠ‚ç‚¹åˆ†å¸ƒåˆ†æ
```bash
for node in {1..10}; do
  traceroute -n cdn-node$node.example.com >> cdn-routes.log
done
```

### åœºæ™¯3ï¼šç½‘ç»œå‰²æ¥éªŒè¯
```bash
# å‰²æ¥å‰è·¯å¾„è®°å½•
traceroute -n critical-service.example.com > pre-cut.log

# å‰²æ¥åè·¯å¾„å¯¹æ¯”
traceroute -n critical-service.example.com > post-cut.log
diff pre-cut.log post-cut.log
```

---

## ä¸ƒã€æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ

1. **æƒé™è¦æ±‚**ï¼šæ™®é€šç”¨æˆ·å¯æ‰§è¡Œï¼Œä½†éƒ¨åˆ†åŠŸèƒ½éœ€è¦rootæƒé™
2. **é˜²ç«å¢™å½±å“**ï¼šæŸäº›èŠ‚ç‚¹å¯èƒ½è¿‡æ»¤ICMP/UDPæŠ¥æ–‡å¯¼è‡´ç»“æœä¸å®Œæ•´
3. **ç»“æœæ³¢åŠ¨**ï¼šç½‘ç»œçŠ¶å†µåŠ¨æ€å˜åŒ–ï¼Œå»ºè®®å¤šæ¬¡æµ‹è¯•å–å¹³å‡å€¼
4. **ä¼ä¸šç½‘ç»œ**ï¼šç”Ÿäº§ç¯å¢ƒæ“ä½œéœ€éµå®ˆç½‘ç»œå®‰å…¨ç­–ç•¥
5. **æ›¿ä»£å·¥å…·**ï¼šæ¨èä½¿ç”¨`mtr`è¿›è¡ŒæŒç»­ç›‘æµ‹ï¼Œ`tcptraceroute`ç”¨äºTCPç«¯å£è¿½è¸ª

> **ä¸“å®¶æç¤º**ï¼šç»“åˆ`ip route get`å‘½ä»¤éªŒè¯å…·ä½“è·¯ç”±è·¯å¾„  
> ```bash
> ip route get 8.8.8.8
> ```

é€šè¿‡æŒæ¡`traceroute`å‘½ä»¤ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š  
1. å¿«é€Ÿå®šä½ç½‘ç»œä¸­æ–­èŠ‚ç‚¹  
2. åˆ†æè·¨å›½ä¸šåŠ¡é“¾è·¯è´¨é‡  
3. éªŒè¯ç½‘ç»œæ¶æ„å˜æ›´æ•ˆæœ  
4. ä¼˜åŒ–CDNèŠ‚ç‚¹åˆ†å¸ƒç­–ç•¥  
5. è¯Šæ–­å¤æ‚ç½‘ç»œæ€§èƒ½é—®é¢˜

# Linux `iftop` å‘½ä»¤å®Œå…¨æŒ‡å—ï¼šå®æ—¶å¸¦å®½ç›‘æ§ä¸æµé‡åˆ†æ

## ä¸€ã€æ ¸å¿ƒåŠŸèƒ½è§£æ  
`iftop` æ˜¯ Linux ç³»ç»Ÿçš„ **å®æ—¶å¸¦å®½ç›‘æ§åˆ©å™¨**ï¼Œæä¾›ç±»ä¼¼ `top` å‘½ä»¤çš„äº¤äº’å¼ç•Œé¢ï¼Œä¸“ä¸ºç½‘ç»œæµé‡åˆ†æè®¾è®¡ã€‚ä¸»è¦èƒ½åŠ›åŒ…æ‹¬ï¼š  
âœ… å®æ—¶æ˜¾ç¤ºç½‘ç»œæ¥å£å¸¦å®½ä½¿ç”¨æƒ…å†µ  
âœ… è¯†åˆ«æµé‡æ¶ˆè€—æœ€å¤§çš„ä¸»æœº/æœåŠ¡  
âœ… æ”¯æŒåŒå‘æµé‡ç»Ÿè®¡ï¼ˆå‘é€/æ¥æ”¶ï¼‰  
âœ… è‡ªå®šä¹‰æ’åºä¸æ˜¾ç¤ºæ¨¡å¼  
âœ… å¿«é€Ÿå®šä½å¼‚å¸¸ç½‘ç»œæ´»åŠ¨  

```mermaid
graph TB
A[iftopç›‘æ§æµç¨‹] --> B[é€‰æ‹©ç½‘ç»œæ¥å£]
A --> C[æ•è·åŸå§‹æµé‡]
A --> D[è§£æIP/ç«¯å£]
A --> E[å®æ—¶ç»Ÿè®¡åˆ†æ]
B --> F[æŒ‡å®šæ¥å£å‚æ•° -i]
C --> G[BPFè¿‡æ»¤å™¨]
D --> H[DNSè§£æå¼€å…³ -n]
E --> I[ç»ˆç«¯äº¤äº’æ“ä½œ]
```

---

## äºŒã€å®‰è£…æ–¹æ³•ä¸ä¾èµ–

### å„å‘è¡Œç‰ˆå®‰è£…å‘½ä»¤
| ç³»ç»Ÿç±»å‹               | å®‰è£…å‘½ä»¤                          |
|-----------------------|----------------------------------|
| RHEL/CentOS 7åŠä»¥ä¸‹    | `yum install epel-release && yum install iftop` |
| RHEL/CentOS 8/9       | `dnf install epel-release && dnf install iftop` |
| Debian/Ubuntu         | `apt install iftop`             |
| Arch Linux            | `pacman -S iftop`               |

---

## ä¸‰ã€å‚æ•°é€ŸæŸ¥è¡¨

### å¸¸ç”¨è¿è¡Œå‚æ•°
| å‚æ•°          | åŠŸèƒ½æè¿°                          | ç¤ºä¾‹å‘½ä»¤                    |
|--------------|----------------------------------|---------------------------|
| `-i <æ¥å£>`   | æŒ‡å®šç›‘æ§çš„ç½‘ç»œæ¥å£                | `iftop -i eth0`          |
| `-n`         | ç¦ç”¨DNSåå‘è§£æ                  | `iftop -n`               |
| `-N`         | ç¦ç”¨ç«¯å£æœåŠ¡åç§°è½¬æ¢              | `iftop -N`               |
| `-b`         | ç¦ç”¨æµé‡æŸ±çŠ¶å›¾æ˜¾ç¤º                | `iftop -b`               |
| `-t`         | æ–‡æœ¬æ¨¡å¼è¾“å‡ºï¼ˆæ— äº¤äº’ç•Œé¢ï¼‰        | `iftop -t`               |
| `-o source`  | æŒ‰æºåœ°å€æ’åºæµé‡                  | `iftop -o source`        |
| `-o destination` | æŒ‰ç›®æ ‡åœ°å€æ’åºæµé‡            | `iftop -o destination`   |
| `-L <è¡Œæ•°>`   | é™åˆ¶æ˜¾ç¤ºæ¡ç›®æ•°é‡                  | `iftop -L 10`            |
| `-P`         | æ˜¾ç¤ºç«¯å£å·                        | `iftop -P`               |

---

## å››ã€å®æˆ˜ç›‘æ§åœºæ™¯

### åœºæ™¯1ï¼šåŸºç¡€ç›‘æ§
```bash
sudo iftop -i eth0
```
![åŸºç¡€ç›‘æ§ç•Œé¢](https://via.placeholder.com/800x400.png?text=iftop+åŸºç¡€ç•Œé¢ç¤ºä¾‹)
- **ç•Œé¢åˆ†åŒº**ï¼š
  1. æµé‡æ¯”ä¾‹æ¡ï¼šæ˜¾ç¤ºå®æ—¶å¸¦å®½å ç”¨æ¯”ä¾‹
  2. è¿æ¥åˆ—è¡¨ï¼šæºIP â†â†’ ç›®æ ‡IP çš„æµé‡ç»Ÿè®¡
  3. ç»Ÿè®¡æ‘˜è¦ï¼šTXï¼ˆå‘é€ï¼‰/RXï¼ˆæ¥æ”¶ï¼‰æ€»é‡

### åœºæ™¯2ï¼šæ’æŸ¥é«˜æµé‡IP
```bash
sudo iftop -nNP -i eth0
```
```text
191Mb         381Mb         572Mb        762Mb     953Mb
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
10.0.0.12:443  => 192.168.1.25:55682   2.03Mb  1.84Mb  1.77Mb
10.0.0.12:443  <= 192.168.1.25:55682    356Kb   412Kb   389Kb
```

### åœºæ™¯3ï¼šç”Ÿæˆæ–‡æœ¬æŠ¥å‘Š
```bash
sudo iftop -t -i eth0 -L 5 > traffic.log
```

---

## äº”ã€äº¤äº’å¼æ“ä½œæŒ‡å—

### å®æ—¶æ§åˆ¶å¿«æ·é”®
| å¿«æ·é”®       | åŠŸèƒ½æè¿°                          |
|-------------|----------------------------------|
| `h`         | æ˜¾ç¤ºå¸®åŠ©èœå•                     |
| `s`/`d`     | åˆ‡æ¢æº/ç›®æ ‡æ˜¾ç¤ºæ¨¡å¼              |
| `S`/`D`     | åˆ‡æ¢ç«¯å£æ˜¾ç¤ºçŠ¶æ€                 |
| `t`         | åˆ‡æ¢æµé‡æ˜¾ç¤ºæ¨¡å¼ï¼ˆçº¿æ€§/å¯¹æ•°ï¼‰    |
| `j`/`k`     | æ»šåŠ¨æµè§ˆè¿æ¥åˆ—è¡¨                 |
| `q`         | é€€å‡ºç¨‹åº                         |

---

## å…­ã€ä¼ä¸šçº§åº”ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šDDoSæ”»å‡»æ£€æµ‹
```bash
iftop -i eth0 -f 'dst port 80' -n
```
- **ç‰¹å¾è¯†åˆ«**ï¼š
  - å•ä¸€ç›®æ ‡IPæ¥æ”¶å¼‚å¸¸é«˜æµé‡
  - å¤§é‡ä¸åŒæºIPçš„çŸ­æœŸè¿æ¥
  - SYNåŒ…æ¯”ä¾‹æ˜¾è‘—å‡é«˜

### æ¡ˆä¾‹2ï¼šæ•°æ®åº“æ³„éœ²ç›‘æ§
```bash
iftop -i eth0 -o destination -nNP | grep ':5432'
```
- **ç›‘æ§è¦ç‚¹**ï¼š
  - éæˆæƒIPè®¿é—®æ•°æ®åº“ç«¯å£
  - å¼‚å¸¸æ—¶é—´æ®µçš„æ‰¹é‡æ•°æ®ä¼ è¾“
  - åŠ å¯†æµé‡çš„å¤§å°å’Œé¢‘ç‡å¼‚å¸¸

---

## ä¸ƒã€æ³¨æ„äº‹é¡¹ä¸æŠ€å·§

1. **æƒé™è¦æ±‚**ï¼šéœ€è¦rootæƒé™æ•è·ç½‘ç»œæ¥å£æ•°æ®
2. **æ€§èƒ½å½±å“**ï¼šé«˜æµé‡ç¯å¢ƒä¸‹å»ºè®®é…åˆ`nload`ä½¿ç”¨
3. **è¿‡æ»¤æŠ€å·§**ï¼š
   ```bash
   # ç›‘æ§æŒ‡å®šç½‘æ®µ
   iftop -i eth0 -F 192.168.1.0/24
   
   # æ’é™¤SSHæµé‡
   iftop -i eth0 -f 'not port 22'
   ```
4. **æ•°æ®ä¿å­˜**ï¼šç»“åˆ`tee`å‘½ä»¤å®æ—¶è®°å½•
   ```bash
   iftop -t -i eth0 | tee network.log
   ```

> **ä¸“å®¶å»ºè®®**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®é…ç½®`vnstat`è¿›è¡Œé•¿æœŸæµé‡ç»Ÿè®¡ï¼Œä¸`iftop`å®æ—¶ç›‘æ§å½¢æˆäº’è¡¥

é€šè¿‡æŒæ¡`iftop`å‘½ä»¤ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š  
1. å®æ—¶å®šä½å¸¦å®½æ¶ˆè€—æº  
2. å¿«é€Ÿè¯†åˆ«å¼‚å¸¸ç½‘ç»œè¡Œä¸º  
3. ä¼˜åŒ–ç½‘ç»œèµ„æºåˆ†é…ç­–ç•¥  
4. æå‡æ•…éšœæ’æŸ¥æ•ˆç‡  
5. å¢å¼ºç½‘ç»œå®‰å…¨ç®¡ç†èƒ½åŠ›

# Linux `tracepath` å‘½ä»¤å®Œå…¨æŒ‡å—ï¼šè·¯å¾„è¿½è¸ªä¸ MTU æ¢æµ‹

## ä¸€ã€æ ¸å¿ƒåŠŸèƒ½è§£æ  
`tracepath` æ˜¯ Linux ç³»ç»Ÿçš„ **è½»é‡çº§è·¯å¾„è¿½è¸ªå·¥å…·**ï¼Œæ— éœ€ root æƒé™å³å¯ä½¿ç”¨ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š  
âœ… è·Ÿè¸ªæ•°æ®åŒ…ä¼ è¾“è·¯å¾„  
âœ… è‡ªåŠ¨æ¢æµ‹è·¯å¾„ MTU å€¼  
âœ… è¯†åˆ«ç½‘ç»œç“¶é¢ˆèŠ‚ç‚¹  
âœ… æ”¯æŒ IPv4/IPv6 åŒåè®®æ ˆ  
âœ… è¾“å‡ºå‹å¥½æ˜“è¯»çš„è¯Šæ–­ä¿¡æ¯  

```mermaid
graph TB
A[æ•°æ®åŒ…å‘é€] --> B[é€è·³TTLé€’å¢]
B --> C{æ˜¯å¦åˆ°è¾¾ç›®æ ‡?}
C -->|æ˜¯| D[è¾“å‡ºå®Œæ•´è·¯å¾„]
C -->|å¦| E[è®°å½•èŠ‚ç‚¹å“åº”]
E --> F[è®¡ç®—RTTä¸MTU]
F --> B
```

---

## äºŒã€å‘½ä»¤è¯­æ³•ä¸å‚æ•°é€ŸæŸ¥

### åŸºç¡€è¯­æ³•æ ¼å¼
```bash
tracepath [é€‰é¡¹] ç›®æ ‡åœ°å€
tracepath6 [é€‰é¡¹] ç›®æ ‡åœ°å€ # IPv6ä¸“ç”¨
```

### æ ¸å¿ƒå‚æ•°å¯¹ç…§è¡¨

| å‚æ•°        | åŠŸèƒ½æè¿°                          | ç¤ºä¾‹å‘½ä»¤                    |
|-------------|----------------------------------|----------------------------|
| `-n`        | ç¦ç”¨DNSè§£æï¼ˆä»…æ˜¾ç¤ºIPåœ°å€ï¼‰       | `tracepath -n 8.8.8.8`    |
| `-b`        | åŒæ—¶æ˜¾ç¤ºä¸»æœºåå’ŒIPåœ°å€            | `tracepath -b google.com` |
| `-l <é•¿åº¦>` | è®¾ç½®åˆå§‹æ•°æ®åŒ…é•¿åº¦                | `tracepath -l 1500 example.com` |
| `-m <è·³æ•°>` | è®¾ç½®æœ€å¤§è¿½è¸ªè·³æ•°ï¼ˆé»˜è®¤30ï¼‰        | `tracepath -m 15 192.168.1.1` |
| `-p <ç«¯å£>` | æŒ‡å®šåˆå§‹ç›®æ ‡ç«¯å£                  | `tracepath -p 8080 api.service` |

---

## ä¸‰ã€å®æˆ˜åº”ç”¨åœºæ™¯

### åœºæ™¯1ï¼šåŸºç¡€è·¯å¾„è¿½è¸ª
```bash
tracepath www.baidu.com
```
```text
 1?: [LOCALHOST]     pmtu 1500
 1:  192.168.1.1              0.867ms 
 1:  192.168.1.1              0.341ms 
 2:  10.88.32.1               5.112ms 
 3:  202.97.33.86            11.987ms 
 ...
```

### åœºæ™¯2ï¼šMTU é—®é¢˜è¯Šæ–­
```bash
tracepath -l 1500 nas.local
```
```text
 5:  172.18.5.1               15.21ms pmtu 1492
 5:  172.18.5.1               14.98ms 
 6:  !N                        =é€šä¿¡è¢«ç®¡ç†å‘˜ç¦æ­¢
```
**è¯Šæ–­ç»“è®º**ï¼šç¬¬5è·³èŠ‚ç‚¹MTUé™ä¸º1492ï¼Œéœ€è°ƒæ•´æœ¬åœ°MTUè®¾ç½®

### åœºæ™¯3ï¼šIPv6 ç½‘ç»œåˆ†æ
```bash
tracepath6 2001:db8::1
```

---

## å››ã€è¾“å‡ºå…³é”®ä¿¡æ¯è§£è¯»

### å…¸å‹è¾“å‡ºç»“æ„è§£æ
```text
è·³æ•° èŠ‚ç‚¹çŠ¶æ€        IPåœ°å€          RTTå»¶è¿Ÿ     MTUå€¼
 1?: [LOCALHOST]                 pmtu 1500
 2:  10.0.0.1                   1.234ms 
 3:  203.0.113.45               12.345ms 
 4:  198.51.100.1               22.22ms pmtu 1492
 5:  !X                          =è¿æ¥è¶…æ—¶
```

### çŠ¶æ€ç¬¦å·è¯´æ˜
| ç¬¦å·        | å«ä¹‰                          | å¤„ç†å»ºè®®              |
|-------------|------------------------------|----------------------|
| `pmtu`      | è·¯å¾„MTUå€¼å˜åŒ–                 | æ£€æŸ¥ç½‘ç»œè®¾å¤‡MTUé…ç½®   |
| `!N`        | ç½‘ç»œä¸å¯è¾¾                    | æ£€æŸ¥é˜²ç«å¢™/è·¯ç”±è§„åˆ™   |
| `!X`        | é€šä¿¡è¢«ç®¡ç†ç¦æ­¢                | è”ç³»ç½‘ç»œç®¡ç†å‘˜        |
| `!P`        | åè®®ä¸å¯ç”¨                    | éªŒè¯åè®®æ”¯æŒæƒ…å†µ      |
| `!S`        | æºè·¯ç”±å¤±è´¥                    | æ£€æŸ¥æœ¬åœ°è·¯ç”±è¡¨        |

---

## äº”ã€é«˜çº§è¯Šæ–­æŠ€å·§

### 1. ç»„åˆå‚æ•°æ’æŸ¥
```bash
tracepath -n -m 20 -l 1400 104.193.88.77
```
- `-n` åŠ é€Ÿè§£æ
- `-m 20` é™åˆ¶è¿½è¸ªæ·±åº¦
- `-l 1400` æµ‹è¯•ç‰¹å®šMTU

### 2. æŒç»­ç›‘æ§è·¯å¾„å˜åŒ–
```bash
watch -n 5 tracepath video-cdn.example.com
```

### 3. ä¸ traceroute å¯¹æ¯”åˆ†æ
```bash
tracepath api.service > tracepath.log
traceroute api.service > traceroute.log
diff tracepath.log traceroute.log
```

---

## å…­ã€ä¼ä¸šçº§åº”ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šè·¨å›½ä¸“çº¿è´¨é‡è¯„ä¼°
```bash
tracepath -m 25 overseas-dc.example.net
```
**å…³é”®æŒ‡æ ‡**ï¼š
- è·¨å›½èŠ‚ç‚¹å»¶è¿Ÿçªå¢
- è·¯å¾„MTUä¸€è‡´æ€§
- æœ€åä¸€è·³å»¶è¿Ÿç¨³å®šæ€§

### æ¡ˆä¾‹2ï¼šCDNèŠ‚ç‚¹ä¼˜åŒ–
```bash
for node in cdn{1..5}; do
   tracepath $node.example-cdn.com >> cdn-path-report.txt
done
```

### æ¡ˆä¾‹3ï¼šVPNéš§é“éªŒè¯
```bash
tracepath -l 1420 vpn-gateway.example.com
```
**éªŒè¯è¦ç‚¹**ï¼š
- éš§é“å…¥å£MTUæ˜¯å¦åŒ¹é…
- åŠ å¯†å¼€é”€æ˜¯å¦å¯¼è‡´åˆ†ç‰‡
- ç«¯åˆ°ç«¯è·¯å¾„ä¸€è‡´æ€§

---

## ä¸ƒã€æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ

1. **æƒé™è¦æ±‚**ï¼šæ™®é€šç”¨æˆ·å¯ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€sudo
2. **åè®®é€‰æ‹©**ï¼š
   - IPv4 ä½¿ç”¨ `tracepath`
   - IPv6 ä½¿ç”¨ `tracepath6`
3. **é˜²ç«å¢™å½±å“**ï¼šæŸäº›èŠ‚ç‚¹å¯èƒ½è¿‡æ»¤UDPåŒ…å¯¼è‡´ç»“æœä¸å…¨
4. **MTUæ¢æµ‹åŸç†**ï¼šåŸºäºICMP Fragmentation Neededæœºåˆ¶
5. **ä¼ä¸šç½‘ç»œ**ï¼šç”Ÿäº§ç¯å¢ƒæ“ä½œéœ€éµå®ˆç½‘ç»œå®‰å…¨ç­–ç•¥

> **ä¸“å®¶æç¤º**ï¼šç»“åˆ `ip route get` éªŒè¯å…·ä½“è·¯ç”±è·¯å¾„  
> ```bash
> ip route get 8.8.8.8
> ```

é€šè¿‡æŒæ¡ `tracepath` å‘½ä»¤ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š  
1. å¿«é€Ÿå®šä½ç½‘ç»œæ–­ç‚¹  
2. è¯Šæ–­MTUä¸åŒ¹é…é—®é¢˜  
3. ä¼˜åŒ–è·¨å¢ƒç½‘ç»œè¿æ¥  
4. éªŒè¯ç½‘ç»œæ¶æ„å˜æ›´æ•ˆæœ  
5. æå‡æ•…éšœæ’æŸ¥æ•ˆç‡