---
title: "Python和Javascript的内存管理"
desc: "Python和Javascript的内存管理"
tags: "pythonBasics"
updateTime: "2025-5-15 15:56"
outline: deep
---

## 一、内存管理核心机制对比

| **特性**             | Python 3                         | JavaScript (V8 引擎)            |
| -------------------- | -------------------------------- | ------------------------------- |
| **主要算法**         | 引用计数 + 分代垃圾回收          | 标记-清除 + 分代回收 + 增量标记 |
| **内存分配**         | 私有堆内存，由 Python 内存管理器 | V8 堆内存（新生代/老生代）      |
| **即时回收**         | 引用计数为零时立即回收           | 周期性垃圾回收                  |
| **循环引用处理**     | 依赖分代回收处理                 | 标记-清除自动处理               |
| **手动控制**         | `gc` 模块可干预                  | 无直接控制 API                  |
| **典型内存泄漏场景** | 循环引用 + `__del__` 方法        | 未移除的事件监听器、全局变量    |

## Python的内存管理
### 1. 引用计数
Python 使用引用计数来管理内存。每个对象都有一个引用计数，当对象的引用计数为零时，它就会被垃圾回收器回收。
**引用计数（主机制）**

```python
a = [1,2,3]  # 引用计数 +1
b = a        # 引用计数 +1 → 2
del b        # 引用计数 -1 → 1
```

- 优点：即时回收
- 缺点：无法处理循环引用
### 2. 分代回收
Python 采用分代回收来处理循环引用。它将对象分为三代，每一代都有一个独立的垃圾回收器。
三代对象（0: 新生代，1: 青年代，2: 老年代）
**分代回收（辅助机制）**
```python
import gc
a = [1,2,3]
b = a
del b
gc.collect()  # 手动触发垃圾回收
```
### 循环引用处理
```python
import gc
a = [1,2,3]
b = a
a.append(b)  # 循环引用
del a
gc.collect()  # 手动触发垃圾回收
```

### 内存优化技巧
- **避免循环引用**：使用 `weakref` 模块

  ```python
  import weakref
  
  class Data:
      pass
  
  obj = Data()
  ref = weakref.ref(obj)  # 弱引用不增加计数
  ```

- **内存视图**：使用 `memoryview` 减少拷贝

  ```python
  data = bytearray(1024)
  mv = memoryview(data)
  ```

---
